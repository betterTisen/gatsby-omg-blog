{"componentChunkName":"component---src-templates-post-js","path":"/post/2021_05_09_qieditor/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby OMG Blog","post":{"pageviews":true}}},"markdownRemark":{"id":"f3ed029a-3590-5702-a2d7-7b94d5edab4a","excerpt":"…","html":"<p>不知大家是否有着这样的需求，一个通用模板的公告类、规则类的静态页面有着长期的更新维护需求。如果每有一次新的更新公告或规则文案变动，都需要修改代码，十分的麻烦。</p>\n<p>所以我就思考🤔，是否可以通过一个可视化的编辑器，让需求方通过零门槛的配置形式自主生成页面，从而避免重复性的体力劳动，达到解放前端同学一部分的生产力去做更有意义的事情。所以便有了本篇文章～</p>\n<p>先看下实现后的效果：</p>\n<p><img src=\"/d96b4ae1231784f2009279391c7ace72/0.gif\"></p>\n<p>接下来，我将带大家从需求至落地，以我的个人思路来完成一个可用的模板页面生成器✌️</p>\n<h2 id=\"需求分析\">需求分析</h2>\n<ol>\n<li>需求方无需拥有开发基础</li>\n<li>需求方通过可视化形式查看需求页面</li>\n<li>需求方自主完成页面内容修改并生成可复用的html文件</li>\n</ol>\n<p><strong>由于个人将该工具定义为编译工具而非运行时脚本，故根据以上需求综合分析，一个基本可用的生成器功能点整理如下</strong></p>\n<ol>\n<li>整个工具由隐式的配置文件主导，页面的生成、配置皆以配置文件为媒介</li>\n<li>配置文件的导入导出</li>\n<li>组件生成与变量提取</li>\n<li>配置文件的解析（编译为.html）</li>\n</ol>\n<p>根据以上需求，该工具大致原型草图如下：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b383c490d4a59cd92a4897b0904a4f74/e5a56/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.798882681564244%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAACG0lEQVQoz02R2XKjMBRE+f9/mnlJvExswDhjVi1IgDYwBgTeDRFJ1dRIXV39oFNdV9fCGAshiqLgnBtnjCGE4jg24Tyc/2kYht7c/47W2srzXAgppKzrk0FVWTLO87zIi6zuqrY/NX1tdL7q6/Widdf3P9IGt7rmNL0e4/P2etxft9vzcnldr8/rnYpEtqlsiGyo6kjA1wk4uO7mcNiEoeN5dhDYlu8uKTjgyAPeOnVsCYBMksL3swJN03g53+7Xx2t8xOKjYLCuKzMiY9QESmPr4CwZxTmBcP+B7C01JAS5HwCyp2VEVTyrjEKxLKui172ZKMto07ScEyvYLUUGijRGn3+ot5OElJSyMEKZfzpLVqbimJ0GEYm1KvNhOJs/SpJE636G9/aaEAIRivY2225aCDsI1F8fs4McAGtj3iYmxOVKqRk2WzDvv5tT63O7xAgkcZh82s3vX9N6PS4W3dZBPBQtTLlP5RwisTLNfT+YZozR8VjPMA/eJ7UzGvBKv79Njjttt9r1UhmqAbJTwlsgBxQrAxdmt6YWAFCW1QyL4G1S9iS2F7yYYduZNhvt7jCPyo4UFWJHrDSN5Fqq7PF49n3ftu39/pxnnpuFPXJ7gIvu/W20nXGz6XYeZmGl80zCosSVziK1kpKO4ziZBX4759jCMKo4VYyIPBUpVoSoNC3zApAgwK4PXR+5QboLUgdCH4CD8R9F0f4Ll6SCmaALhfYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/b383c490d4a59cd92a4897b0904a4f74/799d3/1.png\"\n        srcset=\"/static/b383c490d4a59cd92a4897b0904a4f74/00d96/1.png 148w,\n/static/b383c490d4a59cd92a4897b0904a4f74/0b23c/1.png 295w,\n/static/b383c490d4a59cd92a4897b0904a4f74/799d3/1.png 590w,\n/static/b383c490d4a59cd92a4897b0904a4f74/2a3d6/1.png 885w,\n/static/b383c490d4a59cd92a4897b0904a4f74/ae92f/1.png 1180w,\n/static/b383c490d4a59cd92a4897b0904a4f74/e5a56/1.png 1432w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>首先作为编译型工具，需要有必要的配置文件（json）导入导出编译按钮。</li>\n<li>左侧，是一个可拖拽式组件使得需求方可以根据不同的需求对页面进行定制化配置。</li>\n<li>中间则作为预览框提供实施预览，方便需求方在配置时查看效果</li>\n<li>右侧则为组件的配置项，不同的组件可根据需求开放不同的配置，从而拓展了模板的定制化需求。</li>\n</ul>\n<p>这里的前端框架选择React+TypeScript基础框架，当然技术框架选择不是本文重点，本文主要提供思路。接下来我会按照上述的步骤来实现这几个模块。</p>\n<h2 id=\"配置文件\">配置文件</h2>\n<h3 id=\"配置文件结构\">配置文件结构</h3>\n<p>综合前面的需求分析，我的配置文件解决方案如下：</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"filename\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"导出html时文件名称\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"global\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tab栏中的名称，即document.title\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"css\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"全局css\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"文本流加载完成后执行的js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"beforeLoadJs\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"可选参数：文本流加载前的js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"externalCss\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"可选参数，里面填入字符串链接，用于引入外部的css\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"externalJs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"可选参数，里面填入字符串链接，用于引入外部的js\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"params\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"globalTitle\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"所有组件均可访问的全局变量\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"我是globalTitle\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 初始页面组件</span>\n  <span class=\"token property\">\"main\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 唯一标识，用于组件区分</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"侧边栏中显示的内容\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 自定义局部变量</span>\n      <span class=\"token property\">\"params\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"aParam\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"右侧组件配置中显示的内容\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"可编辑的值：我是aParam\"</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"htmlstr\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;div>我是main &lt;%aParam%> &lt;/div>\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 组件库可复用组件</span>\n  <span class=\"token property\">\"component\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"与main相同\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"params\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"htmlstr\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"&lt;div>&lt;%globalTitle%>我是component&lt;/div>\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>配置文件的内容看注释应该比较清楚了，主要有以下几个功能点：</p>\n<ol>\n<li>全局配置：对应html所必须的内容</li>\n<li>组件：用于需求方根据不同的需求动态选择所需要的html段落</li>\n<li>变量：用于需求方对页面内容进行灵活配置</li>\n</ol>\n<h3 id=\"配置文件的导入与导出\">配置文件的导入与导出</h3>\n<p><strong>配置文件导入：</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleFiles</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">e<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span>ChangeEvent<span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> selectedFile <span class=\"token operator\">=</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files <span class=\"token operator\">&amp;&amp;</span> e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>files<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>selectedFile<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span>\n  <span class=\"token keyword\">const</span> reader <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">FileReader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  reader<span class=\"token punctuation\">.</span><span class=\"token function\">readAsText</span><span class=\"token punctuation\">(</span>selectedFile<span class=\"token punctuation\">)</span>\n  reader<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 这里是将json存入store，方便各个组件编辑读取</span>\n      <span class=\"token function\">setJson2Store</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>result <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    \t<span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"配置导入失败，请检查上传文件类型是否正确!\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>配置文件导出（下载）：</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleFileDownload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">content<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">const</span> filename <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>filename<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">.</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token keyword\">type</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span>\n   <span class=\"token keyword\">const</span> eleLink <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"a\"</span><span class=\"token punctuation\">)</span>\n   eleLink<span class=\"token punctuation\">.</span>download <span class=\"token operator\">=</span> filename\n   eleLink<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>display <span class=\"token operator\">=</span> <span class=\"token string\">\"none\"</span>\n   <span class=\"token keyword\">const</span> blob <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Blob</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>content<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n   eleLink<span class=\"token punctuation\">.</span>href <span class=\"token operator\">=</span> <span class=\"token constant\">URL</span><span class=\"token punctuation\">.</span><span class=\"token function\">createObjectURL</span><span class=\"token punctuation\">(</span>blob<span class=\"token punctuation\">)</span>\n   document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>eleLink<span class=\"token punctuation\">)</span>\n   eleLink<span class=\"token punctuation\">.</span><span class=\"token function\">click</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n   document<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>eleLink<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\t\n\n<span class=\"token comment\">// 导出html文件</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleHtmlDownload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 该方法是将全局配置与属性main中的值传入执行函数，解析成html字符串导出</span>\n  <span class=\"token comment\">// SData2Html具体实现会在下文讲解</span>\n  <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">SData2Html</span><span class=\"token punctuation\">(</span>globalSetting<span class=\"token punctuation\">,</span> mainTree<span class=\"token punctuation\">)</span>\n  <span class=\"token function\">handleFileDownload</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">,</span> <span class=\"token string\">\"html\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 导出json配置文件</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleJsonDownload</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> content <span class=\"token operator\">=</span> <span class=\"token function\">setJson2String</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 该方法就是将store中的json取出</span>\n  <span class=\"token function\">handleFileDownload</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">,</span> <span class=\"token string\">\"json\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"组件\">组件</h2>\n<p>根据之前梳理的需求可知，组件是 <strong>用于需求方根据不同的需求动态选择所需要的html段落并对其可变项进行编辑</strong></p>\n<ol>\n<li>组件是一个html块，可以动态的选择添加</li>\n<li>组件拥有可自定义的变量</li>\n</ol>\n<p>所以，我们通过标签插值的形式使得该工具可以在编译时插入自定义的变量值。</p>\n<p>左侧组件代码块的拖拽添加（拖拽组件选择第三方库 <code class=\"language-text\">react-beautiful-dnd</code>）：</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> DragDropContext<span class=\"token punctuation\">,</span> Droppable<span class=\"token punctuation\">,</span> Draggable<span class=\"token punctuation\">,</span> DropResult <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-beautiful-dnd\"</span>\n\n\n<span class=\"token keyword\">const</span> CompComponent<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">FC</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  \n  <span class=\"token comment\">// 这个函数就是在拖拽结束后添加更新Main数组中的组件块，不是重点，这里就不占用篇幅啦</span>\n  <span class=\"token comment\">// 如果想看该方法的具体实现，可访问：https://github.com/Qionline/Qieditor/blob/master/src/components/main/comp/index.tsx#L14</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleDragEnd</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>comp-cmp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>comp-title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">组件库</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">页面模板</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DragDropContext</span></span> <span class=\"token attr-name\">onDragEnd</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleDragEnd<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* 组件库（可拖拽至页面模板） */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Droppable</span></span> <span class=\"token attr-name\">isDropDisabled</span> <span class=\"token attr-name\">droppableId</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>compLib<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token punctuation\">{</span><span class=\"token parameter\">provided</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n              <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>provided<span class=\"token punctuation\">.</span>innerRef<span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">provided</span><span class=\"token punctuation\">.</span><span class=\"token attr-value\">droppableProps</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                </span><span class=\"token punctuation\">{</span>componentsTree<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">t<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n                  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Draggable</span></span> <span class=\"token attr-name\">draggableId</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>id <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">index</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                    </span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p<span class=\"token punctuation\">,</span> s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n                      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>p<span class=\"token punctuation\">.</span>innerRef<span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">p</span><span class=\"token punctuation\">.</span><span class=\"token attr-value\">draggableProps</span><span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">p</span><span class=\"token punctuation\">.</span><span class=\"token attr-value\">dragHandleProps</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                        </span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Draggable</span></span><span class=\"token punctuation\">></span></span>\n                <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                </span><span class=\"token punctuation\">{</span>provided<span class=\"token punctuation\">.</span>placeholder<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Droppable</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          \n          </span><span class=\"token punctuation\">{</span><span class=\"token comment\">/* 页面模板（可上下拖拽调整组件位置） */</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Droppable</span></span> <span class=\"token attr-name\">droppableId</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>compTemp<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">provided<span class=\"token punctuation\">,</span> snapshot</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n              <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>provided<span class=\"token punctuation\">.</span>innerRef<span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">provided</span><span class=\"token punctuation\">.</span><span class=\"token attr-value\">droppableProps</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                  </span><span class=\"token punctuation\">{</span>mainTree<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">t<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Draggable</span></span> <span class=\"token attr-name\">draggableId</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>id <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">index</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                      </span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">p<span class=\"token punctuation\">,</span> s</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n                          <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span>\n                            <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>p<span class=\"token punctuation\">.</span>innerRef<span class=\"token punctuation\">}</span></span>\n                            <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">p</span><span class=\"token punctuation\">.</span><span class=\"token attr-value\">draggableProps</span><span class=\"token punctuation\">}</span></span>\n                            <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">p</span><span class=\"token punctuation\">.</span><span class=\"token attr-value\">dragHandleProps</span><span class=\"token punctuation\">}</span></span>\n                          <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n                            </span><span class=\"token punctuation\">{</span>t<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n                        <span class=\"token punctuation\">)</span>\n                      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Draggable</span></span><span class=\"token punctuation\">></span></span>\n                  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                  </span><span class=\"token punctuation\">{</span>provided<span class=\"token punctuation\">.</span>placeholder<span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n                </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n              <span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Droppable</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">DragDropContext</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>右侧配置项展示：</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 变量解析组件：从store中获取变量，根据需求方的编辑动态修改store中的配置文件</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">CompConfItem</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> idx<span class=\"token punctuation\">,</span> paramKey<span class=\"token punctuation\">,</span> paramValue <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> handleSetParamValue <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useDataStore</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleChangedParams</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span> <span class=\"token operator\">|</span> ParamArrayParamTypeProp<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">handleSetParamValue</span><span class=\"token punctuation\">(</span>idx<span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">,</span> paramKey<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Input</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>paramValue<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token parameter\">e</span> <span class=\"token operator\">=></span> <span class=\"token function\">handleChangedParams</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>target<span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 全局配置</span>\n<span class=\"token keyword\">const</span> ConfGlobal<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">FC</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">导出文件名</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    \t</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Input</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>globalSetting<span class=\"token punctuation\">.</span>filename<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleChangeFilename<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">页面标题</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Input</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>handleChangeTitle<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    \n    /* 这里的 globalSetting.global.params 是从store中取出的全局变量 */\n    </span><span class=\"token punctuation\">{</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">[</span>v<span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>el<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CompConfItem</span></span> <span class=\"token attr-name\">idx</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">paramKey</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>v<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">paramValue</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>el <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// 组件配置</span>\n<span class=\"token keyword\">const</span> ConfComponent<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">FC</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>title<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token punctuation\">{</span>mainTree<span class=\"token punctuation\">[</span>componetSelectState<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token plain-text\">(</span><span class=\"token punctuation\">{</span>componetSelectState<span class=\"token punctuation\">}</span><span class=\"token plain-text\">)\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      /* 这里的 mainTre 是从store中取出的组件树，其中componetSelectState 为当前选中的组件 */\n      </span><span class=\"token punctuation\">{</span>Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>mainTree<span class=\"token punctuation\">[</span>componetSelectState<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span> <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">该组件无配置项</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>mainTree<span class=\"token punctuation\">[</span>componetSelectState<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v<span class=\"token punctuation\">,</span> i</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> el <span class=\"token operator\">=</span> mainTree<span class=\"token punctuation\">[</span>componetSelectState<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">[</span>v<span class=\"token punctuation\">]</span>\n          <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">key</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>i<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>el<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CompConfItem</span></span> <span class=\"token attr-name\">idx</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>componetSelectState<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">paramKey</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>v<span class=\"token punctuation\">}</span></span> <span class=\"token attr-name\">paramValue</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>el <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n          <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>该段代码均为展示性代码，实际上就是通过可视化的形式对配置文件进行修改</p>\n<h2 id=\"配置文件解析与渲染\">配置文件解析与渲染</h2>\n<p>该工具的整个流程皆始于配置文件，配置文件在工具中可视化的显式给需求方进行配置，配置完成后将更新的配置文件进行解析编译</p>\n<p>上文已完成的配置文件的页面展示，接下来咱们就来完成解析编译的部分。</p>\n<h3 id=\"【解析】组件代码块编译\">【解析】组件代码块编译</h3>\n<p>类型定义：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 变量类型</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ParamTextType</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"text\"</span>\n  title<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  value<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ParamArrayType</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">type</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"array\"</span>\n  title<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  template<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  item<span class=\"token punctuation\">:</span> ParamArrayParamTypeProp\n  value<span class=\"token punctuation\">:</span> ParamArrayParamTypeProp<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> ParamArrayTypeProp <span class=\"token operator\">=</span> ParamTextType \n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> ParamTypeProp <span class=\"token operator\">=</span> ParamTextType <span class=\"token operator\">|</span> ParamArrayType\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ParamArrayParamTypeProp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>propName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> ParamArrayTypeProp\n<span class=\"token punctuation\">}</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">componentsTreePramasProp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">[</span>propName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> ParamTypeProp\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 全局配置类型定义</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">globalSettingProp</span> <span class=\"token punctuation\">{</span>\n  filename<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  global<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    title<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n    direction<span class=\"token punctuation\">:</span> <span class=\"token string\">\"ltr\"</span> <span class=\"token operator\">|</span> <span class=\"token string\">\"rtl\"</span>\n    bodyColor<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n    css<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n    js<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n    beforeLoadJs<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n    externalCss<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    externalJs<span class=\"token operator\">?</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n    params<span class=\"token punctuation\">:</span> componentsTreePramasProp\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 组件项类型定义</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">componentsTreeProp</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span>\n  name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n  params<span class=\"token punctuation\">:</span> componentsTreePramasProp\n  htmlstr<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>编译实现：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// 内部关键字、使用者禁止使用关键字中出现的值作为变量，此关键字用于获取组件块的dom以方便js操作</span>\n<span class=\"token keyword\">const</span> <span class=\"token constant\">KEY_WORD</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token constant\">QID</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;%Qid%>\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token constant\">QIDDOM</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"&lt;%QidDom%>\"</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 错误处理</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleArrayTypeError</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"配置文件错误：禁止array类型参数中使用array类型参数作为子变量!\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 数组变量类型解析</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleArrayTmp</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">template<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> vArray<span class=\"token punctuation\">:</span> ParamArrayParamTypeProp<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  comonParams<span class=\"token punctuation\">:</span> componentsTreePramasProp</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">const</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\">/&lt;%\\w*%>+/g</span>\n  <span class=\"token keyword\">const</span> paramsArr <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>paramsArr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    vArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      tmp<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>template<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  vArray<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> vTemp <span class=\"token operator\">=</span> template\n    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> value <span class=\"token keyword\">of</span> paramsArr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> param <span class=\"token operator\">=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> vTemp <span class=\"token operator\">=</span> vTemp<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>comonParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>comonParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"array\"</span><span class=\"token punctuation\">)</span> <span class=\"token function\">handleArrayTypeError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        vTemp <span class=\"token operator\">=</span> vTemp<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> comonParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    tmp<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>vTemp<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 编译：字符串替换（替换&lt;% %>中的内容）</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TmpReplace</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">,</span> tmp<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> compParams<span class=\"token punctuation\">:</span> componentsTreePramasProp<span class=\"token punctuation\">,</span> globalParams<span class=\"token punctuation\">:</span> componentsTreePramasProp</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 在根div中注入qid &lt;div qid=`q${id}`>&lt;/div></span>\n  <span class=\"token comment\">// qid 可用于js中获取组件块的dom，当然这可根据需求选择是否需要</span>\n  <span class=\"token keyword\">const</span> qidReg <span class=\"token operator\">=</span> <span class=\"token regex\">/&lt;div/</span>\n  tmp <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>qidReg<span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;div qid=\"q</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 关键字替换</span>\n  tmp <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token constant\">KEY_WORD</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QID</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">q</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n  tmp <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token constant\">KEY_WORD</span><span class=\"token punctuation\">.</span><span class=\"token constant\">QIDDOM</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">document.querySelectorAll('[qid=\"q</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\"]')[0]</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// 匹配自定义变量替换</span>\n  <span class=\"token keyword\">const</span> reg <span class=\"token operator\">=</span> <span class=\"token regex\">/&lt;%\\w*%>+/g</span>\n  <span class=\"token keyword\">const</span> paramsArr <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>reg<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>paramsArr<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> tmp\n  \n  <span class=\"token comment\">// 按照层级替换变量值</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> value <span class=\"token keyword\">of</span> paramsArr<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> param <span class=\"token operator\">=</span> value<span class=\"token punctuation\">.</span><span class=\"token function\">split</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>compParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      tmp <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        compParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"array\"</span>\n          <span class=\"token operator\">?</span> <span class=\"token function\">handleArrayTmp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>compParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> ParamArrayType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>template<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>compParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> ParamArrayType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> compParams<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>compParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>globalParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      tmp <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n        globalParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">type</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"array\"</span>\n          <span class=\"token operator\">?</span> <span class=\"token function\">handleArrayTmp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>globalParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> ParamArrayType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>template<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>globalParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> ParamArrayType<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>value<span class=\"token punctuation\">,</span> globalParams<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>globalParams<span class=\"token punctuation\">[</span>param<span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>value <span class=\"token keyword\">as</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> tmp\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"【渲染】文件预览与生成\">【渲染】文件预览与生成</h3>\n<p>预览和生成的逻辑相似，前者是将配置文件转化为html字符串插入iframe进行预览，后者则是将生成的html字符串转化为文件并下载。下面通过代码展示配置文件转化为html部分：</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">interface</span> <span class=\"token class-name\">SData2HtmlFuncProp</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">(</span>globalSetting<span class=\"token punctuation\">:</span> globalSettingProp<span class=\"token punctuation\">,</span> mainTree<span class=\"token punctuation\">:</span> componentsTreeProp<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n <span class=\"token keyword\">const</span> SData2Html<span class=\"token punctuation\">:</span> <span class=\"token function-variable function\">SData2HtmlFuncProp</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">globalSetting<span class=\"token punctuation\">,</span> mainTree</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> main <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span>\n  <span class=\"token comment\">// 依次按照Main中的组件进行解析为html字符串</span>\n  mainTree<span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">el</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// TmpReplace见 上文组件代码块编译 部分</span>\n    <span class=\"token keyword\">const</span> res <span class=\"token operator\">=</span> <span class=\"token function\">TmpReplace</span><span class=\"token punctuation\">(</span>el<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">.</span>htmlstr<span class=\"token punctuation\">,</span> el<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">,</span> globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>params<span class=\"token punctuation\">)</span>\n    main <span class=\"token operator\">+=</span> res\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> beforeLoadJs <span class=\"token operator\">=</span> globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>beforeLoadJs <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;script></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>beforeLoadJs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/script></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n  <span class=\"token keyword\">const</span> externalCss <span class=\"token operator\">=</span> globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>externalCss <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>externalCss<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token keyword\">const</span> externalJs <span class=\"token operator\">=</span> globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>externalJs <span class=\"token operator\">?</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>externalJs<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">\n  &lt;!DOCTYPE html>\n  &lt;html>\n    &lt;head>\n      &lt;meta charset=\"UTF-8\" />\n      &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover\" />\n      &lt;meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\n      &lt;title></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>title<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/title>\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>externalCss<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;link rel=\"stylesheet\" href=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>v<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" /></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n      </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>beforeLoadJs<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    &lt;/head>\n    &lt;style>body{background-color:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>bodyColor<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">;direction:</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>direction<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">}&lt;/style>\n    </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>css <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;style></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>css<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/style></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    &lt;body>\n      &lt;div id=\"qiapp\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>main<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/div>\n    &lt;/body>\n    </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>externalJs<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">v</span> <span class=\"token operator\">=></span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;script src=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>v<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\">&lt;/script></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>js <span class=\"token operator\">?</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;script></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>globalSetting<span class=\"token punctuation\">.</span>global<span class=\"token punctuation\">.</span>js<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/script></span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\n    &lt;/html>\n  </span><span class=\"token template-punctuation string\">`</span></span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>字符串生成后，只需要动态添加更新ifame即可完成预览啦。</p>\n<p>以上，整个编辑器实现的核心思路就都已完成 🎉</p>\n<h2 id=\"完整代码\">完整代码</h2>\n<p>完整代码我已实现并上传至该 <a href=\"https://github.com/Qionline/Qieditor\">仓库</a>，</p>\n<p>如果大家也有类似的需求需要应用于生产环境， 或者具体实现上需要有所参考皆可访问此仓库共同交流学习～</p>\n<p>同时，由于本身json文件的编写较为繁琐、调试性较差。我写了一个简易的开发工具，方便大家以近似纯原生的开发模式来开发&#x26;调试模板文件，如有需要可<a href=\"https://github.com/Qionline/Qieditor-template\"> 点击此处 </a>查看。</p>","headings":[{"value":"需求分析","depth":2},{"value":"配置文件","depth":2},{"value":"配置文件结构","depth":3},{"value":"配置文件的导入与导出","depth":3},{"value":"组件","depth":2},{"value":"配置文件解析与渲染","depth":2},{"value":"【解析】组件代码块编译","depth":3},{"value":"【渲染】文件预览与生成","depth":3},{"value":"完整代码","depth":2}],"frontmatter":{"title":"【手摸手】写一个模板页面生成器","date":"May 09, 2021","description":"不知大家是否有着这样的需求，一个通用模板的公告类、规则类的静态页面有着长期的更新维护需求。如果每有一次新的更新公告或规则文案变动，都需要修改代码，十分的麻烦。所以我就思考🤔，是否可以通过一个可视化的编辑器，让需求方通过零门槛的配置形式自主生成页面，从而避免重复性的体力劳动，达到解放前端同学一部分的生产力去做更有意义的事情。","tags":["react","typescript"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/2021_05_09_qieditor/","previous":{"fields":{"slug":"/post/2020_09_21_mzsf_13/"},"frontmatter":{"title":"【动图算法】（动态规划篇）：最长回文子串"}},"next":null}}}