{"componentChunkName":"component---src-templates-post-js","path":"/post/2020_09_08_chrome_extention/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby OMG Blog","post":{"pageviews":true}}},"markdownRemark":{"id":"9329c163-acdd-5dd9-ba2b-8b8163fcb38a","excerpt":"本拓展程序灵感来自于政采云前端团队的 这篇文章 不同于其知识分享系统，本系统是用于解决不同团队对不同网站的依赖，而开发的一套书签协同管理OA系统，方便多个公用平台的管理。 不多bb…","html":"<blockquote>\n<p>本拓展程序灵感来自于政采云前端团队的 <a href=\"https://juejin.im/post/6854573219895050247\">这篇文章</a><br>\n不同于其知识分享系统，本系统是用于解决不同团队对不同网站的依赖，而开发的一套书签协同管理OA系统，方便多个公用平台的管理。</p>\n</blockquote>\n<p>不多bb，说下开发思路+实践：</p>\n<h2 id=\"共享系统设计思路\">共享系统设计思路</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70ca37f318001c7ddfadf46be3bd7806/2629a/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.752913752913756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACHUlEQVQ4y21T2XLaQBDU//9PXlJ5SOKHVAU7JsHIHA7mEAh0IHQgaS+1Z3YBg5OtGh17zHRP93qtECirCvssw7GuoY2B0vqfaFpJ6wZ5qVG3GsdGozzSvDCQ6n2fx8mGvo9v3++wXAXgwUlN191EUSm8Bhq93xLzQGG2kBhOBBZrgarW9hzv8xhVuN2ibho7IZVy1S5IDRXQyAqJVahwKCXtVdjnCvFeIMuPYJZSu/3eIc/h+8+W9vX4iJBRTF41JeICHeLMEOUOt6NzlKM4sbQf+30MnoZI9xl4K1dk+oywqqXrHcUq1FjvlC1w11NEW8OfakKs4DFcph2sN3j5O8PrfIGiLC2qM3VOmBPV5EDvSiOld5xphBEl3zrUq9AgyTpHeTSe4OHXIynZnoDfUmaKNEMFOkznCi8LjfFMIaBkgxGHOp0CPE7ComzCkJA2F9s4quby3wiFWhCaQlnrsCis/DZVSPYSxbGFIPt4Qko8j0b42eshSVNbxSl7GzFRDguDjHynCU1DyBeFxo68Kek/aw09T6Iwul0UIS+K995ZG7hkbFxtHK2E1M0ocZQarGNKmGjMltRXmudvj28IK8wod1F8sUx36oqLDlGisIs7PAwUBmONT18E7v84pX/cS9tXf0oq8+Hr8fGWnAXpP7X4/LW1KheVwXKjSERzU9b6kEUZjcdYBev/3uMzZeqsTWzIQqYz9pvtxGvX8Qa3MOprvrY+9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/70ca37f318001c7ddfadf46be3bd7806/799d3/1.png\"\n        srcset=\"/static/70ca37f318001c7ddfadf46be3bd7806/00d96/1.png 148w,\n/static/70ca37f318001c7ddfadf46be3bd7806/0b23c/1.png 295w,\n/static/70ca37f318001c7ddfadf46be3bd7806/799d3/1.png 590w,\n/static/70ca37f318001c7ddfadf46be3bd7806/2629a/1.png 858w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>像笔者本身团队中就有很多网站需要存储（还有很多没有截图到…），如果有新同学入职的话，还需要将这些网站一个个分享。非常不方便，该系统可以将需要的网站进行分类存储，将自己团队的同学拉入一个组中，达到共享书签的目的。</p>\n<p>明确了此思路，来整理一下需求：</p>\n<p><strong>用户关系：管理员、普通用户。</strong></p>\n<ul>\n<li>管理员权限：添加文章、查看文章、删除文章、添加分类标签、删除分类标签、移除组成员、解散组</li>\n<li>普通用户权限：添加文章、查看文章、退出组</li>\n</ul>\n<p><strong>UI形式：chrome插件、后台管理系统</strong></p>\n<ul>\n<li>chrome插件：注册登陆、创建/加入组、文章添加、退出登录</li>\n<li>后台管理系统：查看文章、退出/解散组、添加/删除标签、移除组成员、解散组</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a5f7118d480923312d346545ce7c0e5/1a1b4/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.83547557840616%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABYlAAAWJQFJUiTwAAACPElEQVQoz31Sa2/aMBTt//81+zZpmrZuhKo8UkJDKhiQJ7FJ4hC/bZwQZqBVp6nb1fXRsZxzz/V17k7/jrON/tz3/RUv/La9hf3gzq6u6254Izb6U2+Mqei+pKCmqGTgwhkoKWzo4WCT1KY17+I/q9jCUqtgPwpKZ5Osg3qwhE+L0nnZP+YpyDMQp7E+qo/Ftj2hRYK2u0OcoWhXx1kdXTPMLEdhUkbqP2IuRSjd7DRd0dGauis8/oXHcfe4VZMAOVGzUlp/cOfuZMW90HLVjJeNs+Huhs62bBbJ+aL+viGTRM0TvFb6zfmvsHfmyjpP03a8FW4kvFh6sfIi8xDpyZo9xvjN+Tr583te3uQslNhiPxZ+SP2IBiHxQ/IcMs/ipvHCevXqzBgmFBFSY4IorTGuGGvarrXHQmhCGGMSIcy5UqqV8qiUkVraBq34DKG3233J8yEhQwi/E/KzKGZdez52KmTPIfYT+ZIqi34qF7kJgN601+lcxGUZVNUQ5C5CY5APiuK+LOZ2atYmYbMd94FeQDNPuWsTGg+qpWnbi9i+C8ZB103KasT5AwCfIfwEwJBSSXlDyUgJT3KX06nkU8FdyZ8Ym5mufXWua9+2CuEIoUGW3afZVwhnx2NrfwNAQcH3iMOKQ8TyioILZ/t358Ph2ZgHCB2Mv2XZDwAcuLdtn6QxQyanTEZUDJjcMOVgthQaC62MuTn3GIOm2SIUEWIxq2u7LewwbfGC85JzqvVBK6JUoxTRmmp1G9hvFvhGmKRPay4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"大致关系如图所示\"\n        title=\"大致关系如图所示\"\n        src=\"/static/9a5f7118d480923312d346545ce7c0e5/799d3/2.png\"\n        srcset=\"/static/9a5f7118d480923312d346545ce7c0e5/00d96/2.png 148w,\n/static/9a5f7118d480923312d346545ce7c0e5/0b23c/2.png 295w,\n/static/9a5f7118d480923312d346545ce7c0e5/799d3/2.png 590w,\n/static/9a5f7118d480923312d346545ce7c0e5/2a3d6/2.png 885w,\n/static/9a5f7118d480923312d346545ce7c0e5/ae92f/2.png 1180w,\n/static/9a5f7118d480923312d346545ce7c0e5/1a1b4/2.png 1556w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"项目构建\">项目构建</h2>\n<p>别问为什么用React+Ts，问就是React learn once, write anywhere，Ts大法真香。这里直接跑命令构建。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx create-react-app my-app --template typescript</code></pre></div>\n<p>完成后我们创建一下自己需要的目录结构。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">├── config  \t\t\t\t\t<span class=\"token comment\"># ts path配置</span>\n├── public  \t\t\t\t\t<span class=\"token comment\"># 存放 manifest.json 注意：该文件用于chrome拓展的信息识别</span>\n├── script\t\t\t\t\t\t<span class=\"token comment\"># 需要的bash脚本（后面会说）\t</span>\n├── src\t\n│   ├── apis\t\t\t\t\t\t<span class=\"token comment\"># 接口</span>\n│   ├── components\t\t\t<span class=\"token comment\"># 组件</span>\n│   ├── configs\t\t\t\t\t<span class=\"token comment\"># 开发/生产环境区分</span>\n│   ├── contentScripts\t<span class=\"token comment\"># 用于 chrome</span>\n│   ├── pages\t\t\t\t\t\t<span class=\"token comment\"># 页面</span>\n│   ├── router\t\t\t\t\t<span class=\"token comment\"># 路由</span>\n│   ├── stores\t\t\t\t\t<span class=\"token comment\"># mbox仓库</span>\n│   ├── utils\t\t\t\t\t\t<span class=\"token comment\"># 工具函数</span>\n│   ├── App.tsx\t\t\t\t\t\n│   └── index.tsx\t\t\t\t\n├── craco.config.js\t\t<span class=\"token comment\"># 不想eject故通过craco修改配置项</span>\n├── tsconfig.json\t\t\t<span class=\"token comment\"># 一些ts的配置</span>\n└── package.json</code></pre></div>\n<p>chrome拓展打开，就相当于一个网页打开，关闭就是一个网页的关闭。所以我们的拓展需要两个功能。</p>\n<ol>\n<li>保存用户点击tab栏的位置（不能用户每次打开的时候都在第一页，要记录用户的点击信息）</li>\n<li>保存当前浏览器的网页信息（方便用户添加书签）</li>\n</ol>\n<p><img src=\"/1eadd5b152a61a260250397e35d28a1e/3.gif\"></p>\n<p>这里不再去重复普通页面的写法，没有必要。所以着重说一下作为chrome拓展程序和一般web项目不同的地方。</p>\n<h3 id=\"chrome拓展需要识别拓展信息：故需要manifestjson文件。\">chrome拓展需要识别拓展信息：故需要manifest.json文件。</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tnshare\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A plugin for sharing knowledge and common tools\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"tabs\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"storage\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"322\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icon.png\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"browser_action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"default_icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icon.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_popup\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.html\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"matches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;all_urls>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./contentScripts/get_data.js\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"run_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"document_start\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content_security_policy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"script-src 'self' 'sha256-hrABjXgkmzJSAYJz7Tb8+vCZlVwt6UMWGfHKxDlE+2k='; object-src 'self'\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里主要看一下 <code class=\"language-text\">permissions</code> 、 <code class=\"language-text\">content_scripts</code> 和 <code class=\"language-text\">content_security_policy</code></p>\n<ul>\n<li><code class=\"language-text\">permissions</code>：我们开发所需要用到的权限。tabs为拓展与用户页面的信息交互、strong类似于localstorage用于存储用户点击信息</li>\n<li><code class=\"language-text\">content_scripts</code> ：这个是chrome的规定写法，要想获取用户信息，必须创建一个js脚本，Chrome会自动将该脚本注入用户页面，以获取用户网页信息。（注意：content_scripts中js只能获取用户页面的html/css，无法获取其js内容）</li>\n<li><code class=\"language-text\">content_security_policy</code>：因为webpack打包后html会有内联js，chrome插件默认禁止使用内联js，需要这里添加上js的解释形式即可（或者在craco中注入webpack全局配置取消内联注入亦可）</li>\n</ul>\n<h3 id=\"srcipt中的code-classlanguage-textbashcode\">srcipt中的<code class=\"language-text\">bash</code></h3>\n<p>细心的同学可以看到，我们在<code class=\"language-text\">content_scripts</code>中指定了需要注入的js文件位置，打包的时候我们也需要保证该文件位置的一致性。由于不想eject，所以需要来写一个bash srcipt，在打包完成后将该文件夹下的内容注入到build目录下。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># 注意需要加下权限：chmod +x script/build.sh</span>\n<span class=\"token function-name function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">mkdir</span> -p build/contentScripts\n  <span class=\"token function\">cp</span> -r src/contentScripts/* build/contentScripts\n<span class=\"token punctuation\">}</span>\nbuild</code></pre></div>\n<h3 id=\"code-classlanguage-textutilschrome_methodstscode下，规避开发环境没有chrome全局变量的问题\"><code class=\"language-text\">utils/chrome_methods.ts</code>下，规避开发环境没有chrome全局变量的问题</h3>\n<p>还有一个问题，由于chrome拓展中的功能使用到的是Chrome注入的全局变量。但是在本地开发的时候，没有这个变量，导致页面报错，如果我们直接注释代码又太不优雅。。。故需要将生产环境与开发环境的变量分离。</p>\n<p>为了减少行数，代码内容把tab选项卡点击类型做了删减、减少一下重复度，一大坨代码要我我也看不下去🥕</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> stores <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/stores/index\"</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IChromeMethodsProps</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">ChromeTabsQuery</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cb<span class=\"token punctuation\">:</span> Function</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// 获取外部链接</span>\n  <span class=\"token function-variable function\">ChromeSetTabIdx</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span>Key<span class=\"token punctuation\">,</span> cb<span class=\"token punctuation\">:</span> Function</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// 设置tab选项卡点击位置</span>\n  <span class=\"token function-variable function\">ChromeGetTabIdx</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token function-variable function\">cb</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tab<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// 获取tab选项卡点击位置</span>\n  <span class=\"token function-variable function\">ChromeSetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">token<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Promise<span class=\"token operator\">&lt;</span>string<span class=\"token operator\">></span> <span class=\"token comment\">// 设置token</span>\n  <span class=\"token function-variable function\">ChromeGetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Promise<span class=\"token operator\">&lt;</span>string<span class=\"token operator\">></span> <span class=\"token comment\">// 获取token</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> dev_methods<span class=\"token punctuation\">:</span> IChromeMethodsProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">ChromeTabsQuery</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">cb</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"i m title\"</span><span class=\"token punctuation\">,</span>\n      link<span class=\"token punctuation\">:</span> <span class=\"token string\">\"i m link\"</span><span class=\"token punctuation\">,</span>\n      description<span class=\"token punctuation\">:</span> <span class=\"token string\">\"im description\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeSetToken</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">token</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">)</span>\n      stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeGetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span>\n      stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> prod_methods<span class=\"token punctuation\">:</span> IChromeMethodsProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">ChromeTabsQuery</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    chrome<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> active<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> currentWindow<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tabs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      chrome<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tabs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id <span class=\"token keyword\">as</span> number<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> action<span class=\"token punctuation\">:</span> <span class=\"token string\">\"GET_PAGE_DATA\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeSetToken</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">token</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      chrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> token <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeGetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      chrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> res <span class=\"token operator\">?</span> res<span class=\"token punctuation\">.</span>token <span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n        stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> Methods <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">REACT_APP_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"dev\"</span> <span class=\"token operator\">?</span> dev_methods <span class=\"token punctuation\">:</span> prod_methods\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>Methods<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>这里有个地方要注意：<code class=\"language-text\">chrome.storage</code>是异步存储（为了提高本地io速度），<code class=\"language-text\">localstorage</code>是同步存储。所以我们这里需要用promise包一层才能保证调用方式的一致性。</p>\n<h3 id=\"其他\">其他</h3>\n<ul>\n<li>在ts环境中，我们直接使用chrome全局变量是会报错的，下载一个<code class=\"language-text\">@types/chrome</code>即可获取其类型构造。</li>\n</ul>\n<h3 id=\"后台页面\">后台页面</h3>\n<p><img src=\"/b614613989c44f67938add3b2b090149/4.gif\" alt=\"这张gif比较大。。压缩后的渲染问题大家当没看见哈...\"></p>\n<p>后台本身没有什么复杂的难点，即常规的页面开发。这里的gif就放上图片演示，作为一个完整项目的功能展示🤫。。。</p>\n<h2 id=\"最后\">最后</h2>\n<p>chrome插件使用文档和下载地址可在<a href=\"https://github.com/betterTisen/Tnshare_Doc\">我的github中查看</a>。</p>\n<p>由于目前该服务在我自己的小霸王服务器上跑，故没有开源。大家可以体验一下～如果有开源需求的话，点赞这篇文章，如果多的话我会开源分享给大家，不过会停止本服务器上的线上服务。</p>","headings":[{"value":"共享系统设计思路","depth":2},{"value":"项目构建","depth":2},{"value":"chrome拓展需要识别拓展信息：故需要manifest.json文件。","depth":3},{"value":"srcipt中的<code class=\"language-text\">bash</code>","depth":3},{"value":"<code class=\"language-text\">utils/chrome_methods.ts</code>下，规避开发环境没有chrome全局变量的问题","depth":3},{"value":"其他","depth":3},{"value":"后台页面","depth":3},{"value":"最后","depth":2}],"frontmatter":{"title":"React + TypeScript 写一个Chrome书签共享平台","date":"September 08, 2020","description":"随着网站复杂度逐渐提高，各式各样的高效网站被当作生产力工具，有着不同的功能。团队所需要的网站也是越来越多。该拓展实现了多用户公用书签的统一管理，提高团队的协同效率。是一个可以做到一名用户添加，多名用户共享的知识、web工具分享平台。","tags":["typescript","react"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/2020_09_08_chrome_extention/","previous":{"fields":{"slug":"/post/2020_08_24_mzsf_11/"},"frontmatter":{"title":"【动图算法】：区间调度与区间合并"}},"next":{"fields":{"slug":"/post/2020_09_14_mzsf_12/"},"frontmatter":{"title":"【动图算法】（动态规划篇）：斐波那契数"}}}}}