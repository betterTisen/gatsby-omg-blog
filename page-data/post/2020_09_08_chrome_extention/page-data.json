{"componentChunkName":"component---src-templates-post-js","path":"/post/2020_09_08_chrome_extention/","result":{"data":{"site":{"siteMetadata":{"title":"Gatsby OMG Blog","post":{"pageviews":true}}},"markdownRemark":{"id":"9329c163-acdd-5dd9-ba2b-8b8163fcb38a","excerpt":"æœ¬æ‹“å±•ç¨‹åºçµæ„Ÿæ¥è‡ªäºæ”¿é‡‡äº‘å‰ç«¯å›¢é˜Ÿçš„ è¿™ç¯‡æ–‡ç«  ä¸åŒäºå…¶çŸ¥è¯†åˆ†äº«ç³»ç»Ÿï¼Œæœ¬ç³»ç»Ÿæ˜¯ç”¨äºè§£å†³ä¸åŒå›¢é˜Ÿå¯¹ä¸åŒç½‘ç«™çš„ä¾èµ–ï¼Œè€Œå¼€å‘çš„ä¸€å¥—ä¹¦ç­¾ååŒç®¡ç†OAç³»ç»Ÿï¼Œæ–¹ä¾¿å¤šä¸ªå…¬ç”¨å¹³å°çš„ç®¡ç†ã€‚ ä¸å¤šbbâ€¦","html":"<blockquote>\n<p>æœ¬æ‹“å±•ç¨‹åºçµæ„Ÿæ¥è‡ªäºæ”¿é‡‡äº‘å‰ç«¯å›¢é˜Ÿçš„ <a href=\"https://juejin.im/post/6854573219895050247\">è¿™ç¯‡æ–‡ç« </a><br>\nä¸åŒäºå…¶çŸ¥è¯†åˆ†äº«ç³»ç»Ÿï¼Œæœ¬ç³»ç»Ÿæ˜¯ç”¨äºè§£å†³ä¸åŒå›¢é˜Ÿå¯¹ä¸åŒç½‘ç«™çš„ä¾èµ–ï¼Œè€Œå¼€å‘çš„ä¸€å¥—ä¹¦ç­¾ååŒç®¡ç†OAç³»ç»Ÿï¼Œæ–¹ä¾¿å¤šä¸ªå…¬ç”¨å¹³å°çš„ç®¡ç†ã€‚</p>\n</blockquote>\n<p>ä¸å¤šbbï¼Œè¯´ä¸‹å¼€å‘æ€è·¯+å®è·µï¼š</p>\n<h2 id=\"å…±äº«ç³»ç»Ÿè®¾è®¡æ€è·¯\">å…±äº«ç³»ç»Ÿè®¾è®¡æ€è·¯</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70ca37f318001c7ddfadf46be3bd7806/2629a/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 63.752913752913756%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACHUlEQVQ4y21T2XLaQBDU//9PXlJ5SOKHVAU7JsHIHA7mEAh0IHQgaS+1Z3YBg5OtGh17zHRP93qtECirCvssw7GuoY2B0vqfaFpJ6wZ5qVG3GsdGozzSvDCQ6n2fx8mGvo9v3++wXAXgwUlN191EUSm8Bhq93xLzQGG2kBhOBBZrgarW9hzv8xhVuN2ibho7IZVy1S5IDRXQyAqJVahwKCXtVdjnCvFeIMuPYJZSu/3eIc/h+8+W9vX4iJBRTF41JeICHeLMEOUOt6NzlKM4sbQf+30MnoZI9xl4K1dk+oywqqXrHcUq1FjvlC1w11NEW8OfakKs4DFcph2sN3j5O8PrfIGiLC2qM3VOmBPV5EDvSiOld5xphBEl3zrUq9AgyTpHeTSe4OHXIynZnoDfUmaKNEMFOkznCi8LjfFMIaBkgxGHOp0CPE7ComzCkJA2F9s4quby3wiFWhCaQlnrsCis/DZVSPYSxbGFIPt4Qko8j0b42eshSVNbxSl7GzFRDguDjHynCU1DyBeFxo68Kek/aw09T6Iwul0UIS+K995ZG7hkbFxtHK2E1M0ocZQarGNKmGjMltRXmudvj28IK8wod1F8sUx36oqLDlGisIs7PAwUBmONT18E7v84pX/cS9tXf0oq8+Hr8fGWnAXpP7X4/LW1KheVwXKjSERzU9b6kEUZjcdYBev/3uMzZeqsTWzIQqYz9pvtxGvX8Qa3MOprvrY+9gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"1\"\n        title=\"1\"\n        src=\"/static/70ca37f318001c7ddfadf46be3bd7806/799d3/1.png\"\n        srcset=\"/static/70ca37f318001c7ddfadf46be3bd7806/00d96/1.png 148w,\n/static/70ca37f318001c7ddfadf46be3bd7806/0b23c/1.png 295w,\n/static/70ca37f318001c7ddfadf46be3bd7806/799d3/1.png 590w,\n/static/70ca37f318001c7ddfadf46be3bd7806/2629a/1.png 858w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>åƒç¬”è€…æœ¬èº«å›¢é˜Ÿä¸­å°±æœ‰å¾ˆå¤šç½‘ç«™éœ€è¦å­˜å‚¨ï¼ˆè¿˜æœ‰å¾ˆå¤šæ²¡æœ‰æˆªå›¾åˆ°â€¦ï¼‰ï¼Œå¦‚æœæœ‰æ–°åŒå­¦å…¥èŒçš„è¯ï¼Œè¿˜éœ€è¦å°†è¿™äº›ç½‘ç«™ä¸€ä¸ªä¸ªåˆ†äº«ã€‚éå¸¸ä¸æ–¹ä¾¿ï¼Œè¯¥ç³»ç»Ÿå¯ä»¥å°†éœ€è¦çš„ç½‘ç«™è¿›è¡Œåˆ†ç±»å­˜å‚¨ï¼Œå°†è‡ªå·±å›¢é˜Ÿçš„åŒå­¦æ‹‰å…¥ä¸€ä¸ªç»„ä¸­ï¼Œè¾¾åˆ°å…±äº«ä¹¦ç­¾çš„ç›®çš„ã€‚</p>\n<p>æ˜ç¡®äº†æ­¤æ€è·¯ï¼Œæ¥æ•´ç†ä¸€ä¸‹éœ€æ±‚ï¼š</p>\n<p><strong>ç”¨æˆ·å…³ç³»ï¼šç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ã€‚</strong></p>\n<ul>\n<li>ç®¡ç†å‘˜æƒé™ï¼šæ·»åŠ æ–‡ç« ã€æŸ¥çœ‹æ–‡ç« ã€åˆ é™¤æ–‡ç« ã€æ·»åŠ åˆ†ç±»æ ‡ç­¾ã€åˆ é™¤åˆ†ç±»æ ‡ç­¾ã€ç§»é™¤ç»„æˆå‘˜ã€è§£æ•£ç»„</li>\n<li>æ™®é€šç”¨æˆ·æƒé™ï¼šæ·»åŠ æ–‡ç« ã€æŸ¥çœ‹æ–‡ç« ã€é€€å‡ºç»„</li>\n</ul>\n<p><strong>UIå½¢å¼ï¼šchromeæ’ä»¶ã€åå°ç®¡ç†ç³»ç»Ÿ</strong></p>\n<ul>\n<li>chromeæ’ä»¶ï¼šæ³¨å†Œç™»é™†ã€åˆ›å»º/åŠ å…¥ç»„ã€æ–‡ç« æ·»åŠ ã€é€€å‡ºç™»å½•</li>\n<li>åå°ç®¡ç†ç³»ç»Ÿï¼šæŸ¥çœ‹æ–‡ç« ã€é€€å‡º/è§£æ•£ç»„ã€æ·»åŠ /åˆ é™¤æ ‡ç­¾ã€ç§»é™¤ç»„æˆå‘˜ã€è§£æ•£ç»„</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9a5f7118d480923312d346545ce7c0e5/1a1b4/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.83547557840616%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABYlAAAWJQFJUiTwAAACPElEQVQoz31Sa2/aMBTt//81+zZpmrZuhKo8UkJDKhiQJ7FJ4hC/bZwQZqBVp6nb1fXRsZxzz/V17k7/jrON/tz3/RUv/La9hf3gzq6u6254Izb6U2+Mqei+pKCmqGTgwhkoKWzo4WCT1KY17+I/q9jCUqtgPwpKZ5Osg3qwhE+L0nnZP+YpyDMQp7E+qo/Ftj2hRYK2u0OcoWhXx1kdXTPMLEdhUkbqP2IuRSjd7DRd0dGauis8/oXHcfe4VZMAOVGzUlp/cOfuZMW90HLVjJeNs+Huhs62bBbJ+aL+viGTRM0TvFb6zfmvsHfmyjpP03a8FW4kvFh6sfIi8xDpyZo9xvjN+Tr583te3uQslNhiPxZ+SP2IBiHxQ/IcMs/ipvHCevXqzBgmFBFSY4IorTGuGGvarrXHQmhCGGMSIcy5UqqV8qiUkVraBq34DKG3233J8yEhQwi/E/KzKGZdez52KmTPIfYT+ZIqi34qF7kJgN601+lcxGUZVNUQ5C5CY5APiuK+LOZ2atYmYbMd94FeQDNPuWsTGg+qpWnbi9i+C8ZB103KasT5AwCfIfwEwJBSSXlDyUgJT3KX06nkU8FdyZ8Ym5mufXWua9+2CuEIoUGW3afZVwhnx2NrfwNAQcH3iMOKQ8TyioILZ/t358Ph2ZgHCB2Mv2XZDwAcuLdtn6QxQyanTEZUDJjcMOVgthQaC62MuTn3GIOm2SIUEWIxq2u7LewwbfGC85JzqvVBK6JUoxTRmmp1G9hvFvhGmKRPay4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"å¤§è‡´å…³ç³»å¦‚å›¾æ‰€ç¤º\"\n        title=\"å¤§è‡´å…³ç³»å¦‚å›¾æ‰€ç¤º\"\n        src=\"/static/9a5f7118d480923312d346545ce7c0e5/799d3/2.png\"\n        srcset=\"/static/9a5f7118d480923312d346545ce7c0e5/00d96/2.png 148w,\n/static/9a5f7118d480923312d346545ce7c0e5/0b23c/2.png 295w,\n/static/9a5f7118d480923312d346545ce7c0e5/799d3/2.png 590w,\n/static/9a5f7118d480923312d346545ce7c0e5/2a3d6/2.png 885w,\n/static/9a5f7118d480923312d346545ce7c0e5/ae92f/2.png 1180w,\n/static/9a5f7118d480923312d346545ce7c0e5/1a1b4/2.png 1556w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2 id=\"é¡¹ç›®æ„å»º\">é¡¹ç›®æ„å»º</h2>\n<p>åˆ«é—®ä¸ºä»€ä¹ˆç”¨React+Tsï¼Œé—®å°±æ˜¯React learn once, write anywhereï¼ŒTså¤§æ³•çœŸé¦™ã€‚è¿™é‡Œç›´æ¥è·‘å‘½ä»¤æ„å»ºã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx create-react-app my-app --template typescript</code></pre></div>\n<p>å®Œæˆåæˆ‘ä»¬åˆ›å»ºä¸€ä¸‹è‡ªå·±éœ€è¦çš„ç›®å½•ç»“æ„ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">â”œâ”€â”€ config  \t\t\t\t\t<span class=\"token comment\"># ts pathé…ç½®</span>\nâ”œâ”€â”€ public  \t\t\t\t\t<span class=\"token comment\"># å­˜æ”¾ manifest.json æ³¨æ„ï¼šè¯¥æ–‡ä»¶ç”¨äºchromeæ‹“å±•çš„ä¿¡æ¯è¯†åˆ«</span>\nâ”œâ”€â”€ script\t\t\t\t\t\t<span class=\"token comment\"># éœ€è¦çš„bashè„šæœ¬ï¼ˆåé¢ä¼šè¯´ï¼‰\t</span>\nâ”œâ”€â”€ src\t\nâ”‚   â”œâ”€â”€ apis\t\t\t\t\t\t<span class=\"token comment\"># æ¥å£</span>\nâ”‚   â”œâ”€â”€ components\t\t\t<span class=\"token comment\"># ç»„ä»¶</span>\nâ”‚   â”œâ”€â”€ configs\t\t\t\t\t<span class=\"token comment\"># å¼€å‘/ç”Ÿäº§ç¯å¢ƒåŒºåˆ†</span>\nâ”‚   â”œâ”€â”€ contentScripts\t<span class=\"token comment\"># ç”¨äº chrome</span>\nâ”‚   â”œâ”€â”€ pages\t\t\t\t\t\t<span class=\"token comment\"># é¡µé¢</span>\nâ”‚   â”œâ”€â”€ router\t\t\t\t\t<span class=\"token comment\"># è·¯ç”±</span>\nâ”‚   â”œâ”€â”€ stores\t\t\t\t\t<span class=\"token comment\"># mboxä»“åº“</span>\nâ”‚   â”œâ”€â”€ utils\t\t\t\t\t\t<span class=\"token comment\"># å·¥å…·å‡½æ•°</span>\nâ”‚   â”œâ”€â”€ App.tsx\t\t\t\t\t\nâ”‚   â””â”€â”€ index.tsx\t\t\t\t\nâ”œâ”€â”€ craco.config.js\t\t<span class=\"token comment\"># ä¸æƒ³ejectæ•…é€šè¿‡cracoä¿®æ”¹é…ç½®é¡¹</span>\nâ”œâ”€â”€ tsconfig.json\t\t\t<span class=\"token comment\"># ä¸€äº›tsçš„é…ç½®</span>\nâ””â”€â”€ package.json</code></pre></div>\n<p>chromeæ‹“å±•æ‰“å¼€ï¼Œå°±ç›¸å½“äºä¸€ä¸ªç½‘é¡µæ‰“å¼€ï¼Œå…³é—­å°±æ˜¯ä¸€ä¸ªç½‘é¡µçš„å…³é—­ã€‚æ‰€ä»¥æˆ‘ä»¬çš„æ‹“å±•éœ€è¦ä¸¤ä¸ªåŠŸèƒ½ã€‚</p>\n<ol>\n<li>ä¿å­˜ç”¨æˆ·ç‚¹å‡»tabæ çš„ä½ç½®ï¼ˆä¸èƒ½ç”¨æˆ·æ¯æ¬¡æ‰“å¼€çš„æ—¶å€™éƒ½åœ¨ç¬¬ä¸€é¡µï¼Œè¦è®°å½•ç”¨æˆ·çš„ç‚¹å‡»ä¿¡æ¯ï¼‰</li>\n<li>ä¿å­˜å½“å‰æµè§ˆå™¨çš„ç½‘é¡µä¿¡æ¯ï¼ˆæ–¹ä¾¿ç”¨æˆ·æ·»åŠ ä¹¦ç­¾ï¼‰</li>\n</ol>\n<p><img src=\"/1eadd5b152a61a260250397e35d28a1e/3.gif\"></p>\n<p>è¿™é‡Œä¸å†å»é‡å¤æ™®é€šé¡µé¢çš„å†™æ³•ï¼Œæ²¡æœ‰å¿…è¦ã€‚æ‰€ä»¥ç€é‡è¯´ä¸€ä¸‹ä½œä¸ºchromeæ‹“å±•ç¨‹åºå’Œä¸€èˆ¬webé¡¹ç›®ä¸åŒçš„åœ°æ–¹ã€‚</p>\n<h3 id=\"chromeæ‹“å±•éœ€è¦è¯†åˆ«æ‹“å±•ä¿¡æ¯ï¼šæ•…éœ€è¦manifestjsonæ–‡ä»¶ã€‚\">chromeæ‹“å±•éœ€è¦è¯†åˆ«æ‹“å±•ä¿¡æ¯ï¼šæ•…éœ€è¦manifest.jsonæ–‡ä»¶ã€‚</h3>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"manifest_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Tnshare\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A plugin for sharing knowledge and common tools\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1.0\"</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token property\">\"permissions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"tabs\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"storage\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"icons\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"322\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icon.png\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"browser_action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"default_icon\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"icon.png\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"default_popup\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.html\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content_scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"matches\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"&lt;all_urls>\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"js\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./contentScripts/get_data.js\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"run_at\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"document_start\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"content_security_policy\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"script-src 'self' 'sha256-hrABjXgkmzJSAYJz7Tb8+vCZlVwt6UMWGfHKxDlE+2k='; object-src 'self'\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è¿™é‡Œä¸»è¦çœ‹ä¸€ä¸‹ <code class=\"language-text\">permissions</code> ã€ <code class=\"language-text\">content_scripts</code> å’Œ <code class=\"language-text\">content_security_policy</code></p>\n<ul>\n<li><code class=\"language-text\">permissions</code>ï¼šæˆ‘ä»¬å¼€å‘æ‰€éœ€è¦ç”¨åˆ°çš„æƒé™ã€‚tabsä¸ºæ‹“å±•ä¸ç”¨æˆ·é¡µé¢çš„ä¿¡æ¯äº¤äº’ã€strongç±»ä¼¼äºlocalstorageç”¨äºå­˜å‚¨ç”¨æˆ·ç‚¹å‡»ä¿¡æ¯</li>\n<li><code class=\"language-text\">content_scripts</code> ï¼šè¿™ä¸ªæ˜¯chromeçš„è§„å®šå†™æ³•ï¼Œè¦æƒ³è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªjsè„šæœ¬ï¼ŒChromeä¼šè‡ªåŠ¨å°†è¯¥è„šæœ¬æ³¨å…¥ç”¨æˆ·é¡µé¢ï¼Œä»¥è·å–ç”¨æˆ·ç½‘é¡µä¿¡æ¯ã€‚ï¼ˆæ³¨æ„ï¼šcontent_scriptsä¸­jsåªèƒ½è·å–ç”¨æˆ·é¡µé¢çš„html/cssï¼Œæ— æ³•è·å–å…¶jså†…å®¹ï¼‰</li>\n<li><code class=\"language-text\">content_security_policy</code>ï¼šå› ä¸ºwebpackæ‰“åŒ…åhtmlä¼šæœ‰å†…è”jsï¼Œchromeæ’ä»¶é»˜è®¤ç¦æ­¢ä½¿ç”¨å†…è”jsï¼Œéœ€è¦è¿™é‡Œæ·»åŠ ä¸Šjsçš„è§£é‡Šå½¢å¼å³å¯ï¼ˆæˆ–è€…åœ¨cracoä¸­æ³¨å…¥webpackå…¨å±€é…ç½®å–æ¶ˆå†…è”æ³¨å…¥äº¦å¯ï¼‰</li>\n</ul>\n<h3 id=\"srciptä¸­çš„code-classlanguage-textbashcode\">srciptä¸­çš„<code class=\"language-text\">bash</code></h3>\n<p>ç»†å¿ƒçš„åŒå­¦å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨<code class=\"language-text\">content_scripts</code>ä¸­æŒ‡å®šäº†éœ€è¦æ³¨å…¥çš„jsæ–‡ä»¶ä½ç½®ï¼Œæ‰“åŒ…çš„æ—¶å€™æˆ‘ä»¬ä¹Ÿéœ€è¦ä¿è¯è¯¥æ–‡ä»¶ä½ç½®çš„ä¸€è‡´æ€§ã€‚ç”±äºä¸æƒ³ejectï¼Œæ‰€ä»¥éœ€è¦æ¥å†™ä¸€ä¸ªbash srciptï¼Œåœ¨æ‰“åŒ…å®Œæˆåå°†è¯¥æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹æ³¨å…¥åˆ°buildç›®å½•ä¸‹ã€‚</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># æ³¨æ„éœ€è¦åŠ ä¸‹æƒé™ï¼šchmod +x script/build.sh</span>\n<span class=\"token function-name function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">mkdir</span> -p build/contentScripts\n  <span class=\"token function\">cp</span> -r src/contentScripts/* build/contentScripts\n<span class=\"token punctuation\">}</span>\nbuild</code></pre></div>\n<h3 id=\"code-classlanguage-textutilschrome_methodstscodeä¸‹ï¼Œè§„é¿å¼€å‘ç¯å¢ƒæ²¡æœ‰chromeå…¨å±€å˜é‡çš„é—®é¢˜\"><code class=\"language-text\">utils/chrome_methods.ts</code>ä¸‹ï¼Œè§„é¿å¼€å‘ç¯å¢ƒæ²¡æœ‰chromeå…¨å±€å˜é‡çš„é—®é¢˜</h3>\n<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œç”±äºchromeæ‹“å±•ä¸­çš„åŠŸèƒ½ä½¿ç”¨åˆ°çš„æ˜¯Chromeæ³¨å…¥çš„å…¨å±€å˜é‡ã€‚ä½†æ˜¯åœ¨æœ¬åœ°å¼€å‘çš„æ—¶å€™ï¼Œæ²¡æœ‰è¿™ä¸ªå˜é‡ï¼Œå¯¼è‡´é¡µé¢æŠ¥é”™ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥æ³¨é‡Šä»£ç åˆå¤ªä¸ä¼˜é›…ã€‚ã€‚ã€‚æ•…éœ€è¦å°†ç”Ÿäº§ç¯å¢ƒä¸å¼€å‘ç¯å¢ƒçš„å˜é‡åˆ†ç¦»ã€‚</p>\n<p>ä¸ºäº†å‡å°‘è¡Œæ•°ï¼Œä»£ç å†…å®¹æŠŠtabé€‰é¡¹å¡ç‚¹å‡»ç±»å‹åšäº†åˆ å‡ã€å‡å°‘ä¸€ä¸‹é‡å¤åº¦ï¼Œä¸€å¤§å¨ä»£ç è¦æˆ‘æˆ‘ä¹Ÿçœ‹ä¸ä¸‹å»ğŸ¥•</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">\"react\"</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> stores <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"@/stores/index\"</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">IChromeMethodsProps</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">ChromeTabsQuery</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">cb<span class=\"token punctuation\">:</span> Function</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// è·å–å¤–éƒ¨é“¾æ¥</span>\n  <span class=\"token function-variable function\">ChromeSetTabIdx</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">:</span> React<span class=\"token punctuation\">.</span>Key<span class=\"token punctuation\">,</span> cb<span class=\"token punctuation\">:</span> Function</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// è®¾ç½®tabé€‰é¡¹å¡ç‚¹å‡»ä½ç½®</span>\n  <span class=\"token function-variable function\">ChromeGetTabIdx</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token function-variable function\">cb</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tab<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token keyword\">void</span> <span class=\"token comment\">// è·å–tabé€‰é¡¹å¡ç‚¹å‡»ä½ç½®</span>\n  <span class=\"token function-variable function\">ChromeSetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">token<span class=\"token punctuation\">:</span> string</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Promise<span class=\"token operator\">&lt;</span>string<span class=\"token operator\">></span> <span class=\"token comment\">// è®¾ç½®token</span>\n  <span class=\"token function-variable function\">ChromeGetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Promise<span class=\"token operator\">&lt;</span>string<span class=\"token operator\">></span> <span class=\"token comment\">// è·å–token</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> dev_methods<span class=\"token punctuation\">:</span> IChromeMethodsProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function-variable function\">ChromeTabsQuery</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">cb</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      title<span class=\"token punctuation\">:</span> <span class=\"token string\">\"i m title\"</span><span class=\"token punctuation\">,</span>\n      link<span class=\"token punctuation\">:</span> <span class=\"token string\">\"i m link\"</span><span class=\"token punctuation\">,</span>\n      description<span class=\"token punctuation\">:</span> <span class=\"token string\">\"im description\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeSetToken</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">token</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">setItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">,</span> token<span class=\"token punctuation\">)</span>\n      stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeGetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> localStorage<span class=\"token punctuation\">.</span><span class=\"token function\">getItem</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">||</span> <span class=\"token string\">\"\"</span>\n      stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> prod_methods<span class=\"token punctuation\">:</span> IChromeMethodsProps <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">ChromeTabsQuery</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    chrome<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> active<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span> currentWindow<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">tabs</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      chrome<span class=\"token punctuation\">.</span>tabs<span class=\"token punctuation\">.</span><span class=\"token function\">sendMessage</span><span class=\"token punctuation\">(</span>tabs<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>id <span class=\"token keyword\">as</span> number<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> action<span class=\"token punctuation\">:</span> <span class=\"token string\">\"GET_PAGE_DATA\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span>response<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeSetToken</span><span class=\"token punctuation\">:</span> <span class=\"token parameter\">token</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      chrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">set</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> token <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">ChromeGetToken</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      chrome<span class=\"token punctuation\">.</span>storage<span class=\"token punctuation\">.</span>local<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"token\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> res <span class=\"token operator\">?</span> res<span class=\"token punctuation\">.</span>token <span class=\"token punctuation\">:</span> <span class=\"token string\">\"\"</span>\n        stores<span class=\"token punctuation\">.</span>stateStore<span class=\"token punctuation\">.</span><span class=\"token function\">handleSetToken</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span>token<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> Methods <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">REACT_APP_ENV</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"dev\"</span> <span class=\"token operator\">?</span> dev_methods <span class=\"token punctuation\">:</span> prod_methods\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token operator\">...</span>Methods<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è¿™é‡Œæœ‰ä¸ªåœ°æ–¹è¦æ³¨æ„ï¼š<code class=\"language-text\">chrome.storage</code>æ˜¯å¼‚æ­¥å­˜å‚¨ï¼ˆä¸ºäº†æé«˜æœ¬åœ°ioé€Ÿåº¦ï¼‰ï¼Œ<code class=\"language-text\">localstorage</code>æ˜¯åŒæ­¥å­˜å‚¨ã€‚æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œéœ€è¦ç”¨promiseåŒ…ä¸€å±‚æ‰èƒ½ä¿è¯è°ƒç”¨æ–¹å¼çš„ä¸€è‡´æ€§ã€‚</p>\n<h3 id=\"å…¶ä»–\">å…¶ä»–</h3>\n<ul>\n<li>åœ¨tsç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨chromeå…¨å±€å˜é‡æ˜¯ä¼šæŠ¥é”™çš„ï¼Œä¸‹è½½ä¸€ä¸ª<code class=\"language-text\">@types/chrome</code>å³å¯è·å–å…¶ç±»å‹æ„é€ ã€‚</li>\n</ul>\n<h3 id=\"åå°é¡µé¢\">åå°é¡µé¢</h3>\n<p><img src=\"/b614613989c44f67938add3b2b090149/4.gif\" alt=\"è¿™å¼ gifæ¯”è¾ƒå¤§ã€‚ã€‚å‹ç¼©åçš„æ¸²æŸ“é—®é¢˜å¤§å®¶å½“æ²¡çœ‹è§å“ˆ...\"></p>\n<p>åå°æœ¬èº«æ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„éš¾ç‚¹ï¼Œå³å¸¸è§„çš„é¡µé¢å¼€å‘ã€‚è¿™é‡Œçš„gifå°±æ”¾ä¸Šå›¾ç‰‡æ¼”ç¤ºï¼Œä½œä¸ºä¸€ä¸ªå®Œæ•´é¡¹ç›®çš„åŠŸèƒ½å±•ç¤ºğŸ¤«ã€‚ã€‚ã€‚</p>\n<h2 id=\"æœ€å\">æœ€å</h2>\n<p>chromeæ’ä»¶ä½¿ç”¨æ–‡æ¡£å’Œä¸‹è½½åœ°å€å¯åœ¨<a href=\"https://github.com/betterTisen/Tnshare_Doc\">æˆ‘çš„githubä¸­æŸ¥çœ‹</a>ã€‚</p>\n<p>ç”±äºç›®å‰è¯¥æœåŠ¡åœ¨æˆ‘è‡ªå·±çš„å°éœ¸ç‹æœåŠ¡å™¨ä¸Šè·‘ï¼Œæ•…æ²¡æœ‰å¼€æºã€‚å¤§å®¶å¯ä»¥ä½“éªŒä¸€ä¸‹ï½å¦‚æœæœ‰å¼€æºéœ€æ±‚çš„è¯ï¼Œç‚¹èµè¿™ç¯‡æ–‡ç« ï¼Œå¦‚æœå¤šçš„è¯æˆ‘ä¼šå¼€æºåˆ†äº«ç»™å¤§å®¶ï¼Œä¸è¿‡ä¼šåœæ­¢æœ¬æœåŠ¡å™¨ä¸Šçš„çº¿ä¸ŠæœåŠ¡ã€‚</p>","headings":[{"value":"å…±äº«ç³»ç»Ÿè®¾è®¡æ€è·¯","depth":2},{"value":"é¡¹ç›®æ„å»º","depth":2},{"value":"chromeæ‹“å±•éœ€è¦è¯†åˆ«æ‹“å±•ä¿¡æ¯ï¼šæ•…éœ€è¦manifest.jsonæ–‡ä»¶ã€‚","depth":3},{"value":"srciptä¸­çš„<code class=\"language-text\">bash</code>","depth":3},{"value":"<code class=\"language-text\">utils/chrome_methods.ts</code>ä¸‹ï¼Œè§„é¿å¼€å‘ç¯å¢ƒæ²¡æœ‰chromeå…¨å±€å˜é‡çš„é—®é¢˜","depth":3},{"value":"å…¶ä»–","depth":3},{"value":"åå°é¡µé¢","depth":3},{"value":"æœ€å","depth":2}],"frontmatter":{"title":"React + TypeScript å†™ä¸€ä¸ªChromeä¹¦ç­¾å…±äº«å¹³å°","date":"September 08, 2020","description":"éšç€ç½‘ç«™å¤æ‚åº¦é€æ¸æé«˜ï¼Œå„å¼å„æ ·çš„é«˜æ•ˆç½‘ç«™è¢«å½“ä½œç”Ÿäº§åŠ›å·¥å…·ï¼Œæœ‰ç€ä¸åŒçš„åŠŸèƒ½ã€‚å›¢é˜Ÿæ‰€éœ€è¦çš„ç½‘ç«™ä¹Ÿæ˜¯è¶Šæ¥è¶Šå¤šã€‚è¯¥æ‹“å±•å®ç°äº†å¤šç”¨æˆ·å…¬ç”¨ä¹¦ç­¾çš„ç»Ÿä¸€ç®¡ç†ï¼Œæé«˜å›¢é˜Ÿçš„ååŒæ•ˆç‡ã€‚æ˜¯ä¸€ä¸ªå¯ä»¥åšåˆ°ä¸€åç”¨æˆ·æ·»åŠ ï¼Œå¤šåç”¨æˆ·å…±äº«çš„çŸ¥è¯†ã€webå·¥å…·åˆ†äº«å¹³å°ã€‚","tags":["typescript","react"]}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/2020_09_08_chrome_extention/","previous":{"fields":{"slug":"/post/2020_08_24_mzsf_11/"},"frontmatter":{"title":"ã€åŠ¨å›¾ç®—æ³•ã€‘ï¼šåŒºé—´è°ƒåº¦ä¸åŒºé—´åˆå¹¶"}},"next":{"fields":{"slug":"/post/2020_09_14_mzsf_12/"},"frontmatter":{"title":"ã€åŠ¨å›¾ç®—æ³•ã€‘ï¼ˆåŠ¨æ€è§„åˆ’ç¯‡ï¼‰ï¼šæ–æ³¢é‚£å¥‘æ•°"}}}}}