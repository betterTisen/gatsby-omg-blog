---
title: æ‰‹æ‘¸æ‰‹ï¼šç”¨jså®žçŽ°ä¸€ä¸ªLRUç¼“å­˜æ·˜æ±°å™¨
date: 2020-4-27 14:00:00
tags:
  - javascript
---

## ä»€ä¹ˆæ˜¯ LRU ç®—æ³•

LRU å…¨ç§° **Least Resource Used**ï¼Œç¿»è¯‘è¿‡æ¥å³æ˜¯ æœ€åŽè¢«ä½¿ç”¨çš„èµ„æºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ€åŽè¢«ä½¿ç”¨çš„èµ„æºæ˜¯æœ‰ç”¨çš„ï¼Œå¾ˆä¹…æ²¡æœ‰ä½¿ç”¨è¿‡çš„èµ„æºæ˜¯æ— ç”¨çš„ï¼Œå†…å­˜æ»¡äº†ä¹‹åŽ LRU å°±ä¼šä¼˜å…ˆé”€æ¯ å¾ˆä¹…æ²¡æœ‰ä½¿ç”¨çš„èµ„æºã€‚

ðŸŒ° æ‹¿å®‰å“æ‰‹æœºä¸¾ä¾‹ï¼ŒæŠŠè¿è¡ŒåŽå°æƒ³åƒæˆä¸€ä¸ªå­˜å‚¨ç©ºé—´ï¼Œå‡è®¾æ‰‹æœºæœ€å¤šåªèƒ½åœ¨åŽå°è¿è¡Œ 3 ä¸ªç¨‹åºï¼Œå½“ä½ æŒ‰é¡ºåºæ‰“å¼€ app1ã€app2ã€app3 æ—¶ï¼Œåœ¨ç©ºé—´ä¸­çš„å­˜å‚¨é¡ºåºæŒ‰ LRU çš„æŽ’åºæ–¹å¼ä¸º app3ã€app2ã€app1ï¼Œæ­¤æ—¶å†æ¬¡æ‰“å¼€ app1ã€é¡ºåºå˜ä¸º app1ã€app3ã€app2ï¼Œæœ€åŽå†æ‰“å¼€ app4ï¼Œç”±äºŽåŽå°æœ€å¤šåªèƒ½è¿è¡Œ 3 ä¸ªç¨‹åºï¼Œapp2 ä¸ºæœ€ä¹…æœªæ‰“å¼€çš„ç¨‹åºï¼Œæ‰€ä»¥ app2 è¢«ç§»é™¤ï¼Œapp4 è¿›å…¥åŽå°ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![å›¾ä¾‹](./1.png)

## LRU ç®—æ³•çš„æè¿°

æ ¹æ®ä¸Šé¢çš„ä¾‹å­ï¼Œè®¾æƒ³ä¸€ä¸‹å¦‚æžœæˆ‘ä»¬éœ€è¦å®žçŽ°ä¸€ä¸ªç±»æ¥æ¨¡æ‹Ÿ LRU çš„ç¼“å­˜æ–¹å¼ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¸¸é‡ SIZEï¼Œç”¨äºŽå‘ŠçŸ¥å…¶æœ€å¤§ç¼“å­˜æ•°æ˜¯å¤šå°‘ã€‚å…¶æ¬¡ï¼Œéœ€è¦ä¸€ä¸ª get å’Œ put methodsï¼Œç”¨äºŽèŽ·å–å…¶ä¿å­˜çš„å†…å®¹å’Œæ’å…¥æ–°çš„å†…å®¹ã€‚

## LRU å®žçŽ°

è¿™é‡Œé€‰æ‹©ç”¨ map æ¥å®žçŽ° LRUï¼Œå› ä¸º map çš„é”®å€¼æ’å…¥æ˜¯æœ‰åºçš„,è€Œ object æ’å…¥æ˜¯æ— åºçš„ï¼Œæ— æ³•æ‰¾åˆ°æœ€å…ˆæ’å…¥çš„æ•°æ®

```javascript
class LRUCache {
  constructor(size) {
    this.size = size
    this.map = new Map()
  }

  get(key) {
    let val = this.map.get(key)
    if (typeof val === "undefined") {
      return undefined
    }
    // é‡æ–°å‘mapæ³¨å…¥
    this.map.delete(key)
    this.map.set(key, val)
    return val
  }

  put(key, value) {
    // å¦‚æžœkeyå­˜åœ¨ï¼Œdel key
    if (this.map.has(key)) {
      this.map.delete(key)
    }

    this.map.set(key, value)
    let keys = this.map.keys()
    // é•¿åº¦è¶…å‡ºæ—¶ æ¸…æ¥šç¬¬ä¸€é¡¹
    if (this.map.size > this.size) {
      this.map.delete(keys.next().value)
    }
  }
}
```
