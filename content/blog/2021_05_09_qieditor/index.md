---
title: "ã€æ‰‹æ‘¸æ‰‹ã€‘å†™ä¸€ä¸ªæ¨¡æ¿é¡µé¢ç”Ÿæˆå™¨"
date: 2021-5-9 22:00:00
tags:
  - react
  - typescript
topImg: 5.png
description: "ä¸çŸ¥å¤§å®¶æ˜¯å¦æœ‰ç€è¿™æ ·çš„éœ€æ±‚ï¼Œä¸€ä¸ªé€šç”¨æ¨¡æ¿çš„å…¬å‘Šç±»ã€è§„åˆ™ç±»çš„é™æ€é¡µé¢æœ‰ç€é•¿æœŸçš„æ›´æ–°ç»´æŠ¤éœ€æ±‚ã€‚å¦‚æœæ¯æœ‰ä¸€æ¬¡æ–°çš„æ›´æ–°å…¬å‘Šæˆ–è§„åˆ™æ–‡æ¡ˆå˜åŠ¨ï¼Œéƒ½éœ€è¦ä¿®æ”¹ä»£ç ï¼Œååˆ†çš„éº»çƒ¦ã€‚æ‰€ä»¥æˆ‘å°±æ€è€ƒğŸ¤”ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡ä¸€ä¸ªå¯è§†åŒ–çš„ç¼–è¾‘å™¨ï¼Œè®©éœ€æ±‚æ–¹é€šè¿‡é›¶é—¨æ§›çš„é…ç½®å½¢å¼è‡ªä¸»ç”Ÿæˆé¡µé¢ï¼Œä»è€Œé¿å…é‡å¤æ€§çš„ä½“åŠ›åŠ³åŠ¨ï¼Œè¾¾åˆ°è§£æ”¾å‰ç«¯åŒå­¦ä¸€éƒ¨åˆ†çš„ç”Ÿäº§åŠ›å»åšæ›´æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚"
---

ä¸çŸ¥å¤§å®¶æ˜¯å¦æœ‰ç€è¿™æ ·çš„éœ€æ±‚ï¼Œä¸€ä¸ªé€šç”¨æ¨¡æ¿çš„å…¬å‘Šç±»ã€è§„åˆ™ç±»çš„é™æ€é¡µé¢æœ‰ç€é•¿æœŸçš„æ›´æ–°ç»´æŠ¤éœ€æ±‚ã€‚å¦‚æœæ¯æœ‰ä¸€æ¬¡æ–°çš„æ›´æ–°å…¬å‘Šæˆ–è§„åˆ™æ–‡æ¡ˆå˜åŠ¨ï¼Œéƒ½éœ€è¦ä¿®æ”¹ä»£ç ï¼Œååˆ†çš„éº»çƒ¦ã€‚

æ‰€ä»¥æˆ‘å°±æ€è€ƒğŸ¤”ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡ä¸€ä¸ªå¯è§†åŒ–çš„ç¼–è¾‘å™¨ï¼Œè®©éœ€æ±‚æ–¹é€šè¿‡é›¶é—¨æ§›çš„é…ç½®å½¢å¼è‡ªä¸»ç”Ÿæˆé¡µé¢ï¼Œä»è€Œé¿å…é‡å¤æ€§çš„ä½“åŠ›åŠ³åŠ¨ï¼Œè¾¾åˆ°è§£æ”¾å‰ç«¯åŒå­¦ä¸€éƒ¨åˆ†çš„ç”Ÿäº§åŠ›å»åšæ›´æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚æ‰€ä»¥ä¾¿æœ‰äº†æœ¬ç¯‡æ–‡ç« ï½

å…ˆçœ‹ä¸‹å®ç°åçš„æ•ˆæœï¼š

![](./0.gif)

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å¸¦å¤§å®¶ä»éœ€æ±‚è‡³è½åœ°ï¼Œä»¥æˆ‘çš„ä¸ªäººæ€è·¯æ¥å®Œæˆä¸€ä¸ªå¯ç”¨çš„æ¨¡æ¿é¡µé¢ç”Ÿæˆå™¨âœŒï¸

## éœ€æ±‚åˆ†æ

1. éœ€æ±‚æ–¹æ— éœ€æ‹¥æœ‰å¼€å‘åŸºç¡€
2. éœ€æ±‚æ–¹é€šè¿‡å¯è§†åŒ–å½¢å¼æŸ¥çœ‹éœ€æ±‚é¡µé¢
3. éœ€æ±‚æ–¹è‡ªä¸»å®Œæˆé¡µé¢å†…å®¹ä¿®æ”¹å¹¶ç”Ÿæˆå¯å¤ç”¨çš„htmlæ–‡ä»¶

**ç”±äºä¸ªäººå°†è¯¥å·¥å…·å®šä¹‰ä¸ºç¼–è¯‘å·¥å…·è€Œéè¿è¡Œæ—¶è„šæœ¬ï¼Œæ•…æ ¹æ®ä»¥ä¸Šéœ€æ±‚ç»¼åˆåˆ†æï¼Œä¸€ä¸ªåŸºæœ¬å¯ç”¨çš„ç”Ÿæˆå™¨åŠŸèƒ½ç‚¹æ•´ç†å¦‚ä¸‹**

1. æ•´ä¸ªå·¥å…·ç”±éšå¼çš„é…ç½®æ–‡ä»¶ä¸»å¯¼ï¼Œé¡µé¢çš„ç”Ÿæˆã€é…ç½®çš†ä»¥é…ç½®æ–‡ä»¶ä¸ºåª’ä»‹
2. é…ç½®æ–‡ä»¶çš„å¯¼å…¥å¯¼å‡º
3. ç»„ä»¶ç”Ÿæˆä¸å˜é‡æå–
4. é…ç½®æ–‡ä»¶çš„è§£æï¼ˆç¼–è¯‘ä¸º.htmlï¼‰

æ ¹æ®ä»¥ä¸Šéœ€æ±‚ï¼Œè¯¥å·¥å…·å¤§è‡´åŸå‹è‰å›¾å¦‚ä¸‹ï¼š

![](./1.png)

- é¦–å…ˆä½œä¸ºç¼–è¯‘å‹å·¥å…·ï¼Œéœ€è¦æœ‰å¿…è¦çš„é…ç½®æ–‡ä»¶ï¼ˆjsonï¼‰å¯¼å…¥å¯¼å‡ºç¼–è¯‘æŒ‰é’®ã€‚
- å·¦ä¾§ï¼Œæ˜¯ä¸€ä¸ªå¯æ‹–æ‹½å¼ç»„ä»¶ä½¿å¾—éœ€æ±‚æ–¹å¯ä»¥æ ¹æ®ä¸åŒçš„éœ€æ±‚å¯¹é¡µé¢è¿›è¡Œå®šåˆ¶åŒ–é…ç½®ã€‚
- ä¸­é—´åˆ™ä½œä¸ºé¢„è§ˆæ¡†æä¾›å®æ–½é¢„è§ˆï¼Œæ–¹ä¾¿éœ€æ±‚æ–¹åœ¨é…ç½®æ—¶æŸ¥çœ‹æ•ˆæœ
- å³ä¾§åˆ™ä¸ºç»„ä»¶çš„é…ç½®é¡¹ï¼Œä¸åŒçš„ç»„ä»¶å¯æ ¹æ®éœ€æ±‚å¼€æ”¾ä¸åŒçš„é…ç½®ï¼Œä»è€Œæ‹“å±•äº†æ¨¡æ¿çš„å®šåˆ¶åŒ–éœ€æ±‚ã€‚

è¿™é‡Œçš„å‰ç«¯æ¡†æ¶é€‰æ‹©React+TypeScriptåŸºç¡€æ¡†æ¶ï¼Œå½“ç„¶æŠ€æœ¯æ¡†æ¶é€‰æ‹©ä¸æ˜¯æœ¬æ–‡é‡ç‚¹ï¼Œæœ¬æ–‡ä¸»è¦æä¾›æ€è·¯ã€‚æ¥ä¸‹æ¥æˆ‘ä¼šæŒ‰ç…§ä¸Šè¿°çš„æ­¥éª¤æ¥å®ç°è¿™å‡ ä¸ªæ¨¡å—ã€‚

## é…ç½®æ–‡ä»¶

### é…ç½®æ–‡ä»¶ç»“æ„

ç»¼åˆå‰é¢çš„éœ€æ±‚åˆ†æï¼Œæˆ‘çš„é…ç½®æ–‡ä»¶è§£å†³æ–¹æ¡ˆå¦‚ä¸‹ï¼š

```json
{
  "filename": "å¯¼å‡ºhtmlæ—¶æ–‡ä»¶åç§°",
  "global": {
    "title": "tabæ ä¸­çš„åç§°ï¼Œå³document.title",
    "css": "å…¨å±€css",
    "js": "æ–‡æœ¬æµåŠ è½½å®Œæˆåæ‰§è¡Œçš„js",
    "beforeLoadJs": "å¯é€‰å‚æ•°ï¼šæ–‡æœ¬æµåŠ è½½å‰çš„js",
    "externalCss": ["å¯é€‰å‚æ•°ï¼Œé‡Œé¢å¡«å…¥å­—ç¬¦ä¸²é“¾æ¥ï¼Œç”¨äºå¼•å…¥å¤–éƒ¨çš„css"],
    "externalJs": ["å¯é€‰å‚æ•°ï¼Œé‡Œé¢å¡«å…¥å­—ç¬¦ä¸²é“¾æ¥ï¼Œç”¨äºå¼•å…¥å¤–éƒ¨çš„js"],
    "params": {
      "globalTitle": {
        "type": "text",
        "title": "æ‰€æœ‰ç»„ä»¶å‡å¯è®¿é—®çš„å…¨å±€å˜é‡",
        "value": "æˆ‘æ˜¯globalTitle"
      }
    }
  },
  // åˆå§‹é¡µé¢ç»„ä»¶
  "main": [
    {
      "id": 1, // å”¯ä¸€æ ‡è¯†ï¼Œç”¨äºç»„ä»¶åŒºåˆ†
      "name": "ä¾§è¾¹æ ä¸­æ˜¾ç¤ºçš„å†…å®¹",
      // è‡ªå®šä¹‰å±€éƒ¨å˜é‡
      "params": {
        "aParam": {
          "type": "text",
          "title": "å³ä¾§ç»„ä»¶é…ç½®ä¸­æ˜¾ç¤ºçš„å†…å®¹",
          "value": "å¯ç¼–è¾‘çš„å€¼ï¼šæˆ‘æ˜¯aParam"
        }
      },
      "htmlstr": "<div>æˆ‘æ˜¯main <%aParam%> </div>"
    }
  ],
  // ç»„ä»¶åº“å¯å¤ç”¨ç»„ä»¶
  "component": [
    {
      "id": 2,
      "name": "ä¸mainç›¸åŒ",
      "params": {},
      "htmlstr": "<div><%globalTitle%>æˆ‘æ˜¯component</div>"
    }
  ]
}
```

é…ç½®æ–‡ä»¶çš„å†…å®¹çœ‹æ³¨é‡Šåº”è¯¥æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªåŠŸèƒ½ç‚¹ï¼š

1. å…¨å±€é…ç½®ï¼šå¯¹åº”htmlæ‰€å¿…é¡»çš„å†…å®¹
2. ç»„ä»¶ï¼šç”¨äºéœ€æ±‚æ–¹æ ¹æ®ä¸åŒçš„éœ€æ±‚åŠ¨æ€é€‰æ‹©æ‰€éœ€è¦çš„htmlæ®µè½
3. å˜é‡ï¼šç”¨äºéœ€æ±‚æ–¹å¯¹é¡µé¢å†…å®¹è¿›è¡Œçµæ´»é…ç½®

###  é…ç½®æ–‡ä»¶çš„å¯¼å…¥ä¸å¯¼å‡º

**é…ç½®æ–‡ä»¶å¯¼å…¥ï¼š**

```typescript
const handleFiles = (e: React.ChangeEvent<HTMLInputElement>) => {
  const selectedFile = e.target.files && e.target.files[0]
  if (!selectedFile) return
  const reader = new FileReader()
  reader.readAsText(selectedFile)
  reader.onload = function () {
    try {
      // è¿™é‡Œæ˜¯å°†jsonå­˜å…¥storeï¼Œæ–¹ä¾¿å„ä¸ªç»„ä»¶ç¼–è¾‘è¯»å–
      setJson2Store(this.result as string)
    } catch (error) {
    	console.error("é…ç½®å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦æ­£ç¡®!")
    }
  }
  e.target.value = ""
}
```

**é…ç½®æ–‡ä»¶å¯¼å‡ºï¼ˆä¸‹è½½ï¼‰ï¼š**

```typescript
const handleFileDownload = (content: string, type: string) => {
   const filename = `${globalSetting.filename}.${type}`
   const eleLink = document.createElement("a")
   eleLink.download = filename
   eleLink.style.display = "none"
   const blob = new Blob([content])
   eleLink.href = URL.createObjectURL(blob)
   document.body.appendChild(eleLink)
   eleLink.click()
   document.body.removeChild(eleLink)
}	

// å¯¼å‡ºhtmlæ–‡ä»¶
const handleHtmlDownload = () => {
  // è¯¥æ–¹æ³•æ˜¯å°†å…¨å±€é…ç½®ä¸å±æ€§mainä¸­çš„å€¼ä¼ å…¥æ‰§è¡Œå‡½æ•°ï¼Œè§£ææˆhtmlå­—ç¬¦ä¸²å¯¼å‡º
  // SData2Htmlå…·ä½“å®ç°ä¼šåœ¨ä¸‹æ–‡è®²è§£
  const content = SData2Html(globalSetting, mainTree)
  handleFileDownload(content, "html")
}

// å¯¼å‡ºjsoné…ç½®æ–‡ä»¶
const handleJsonDownload = () => {
  const content = setJson2String() // è¯¥æ–¹æ³•å°±æ˜¯å°†storeä¸­çš„jsonå–å‡º
  handleFileDownload(content, "json")
}
```

## ç»„ä»¶

æ ¹æ®ä¹‹å‰æ¢³ç†çš„éœ€æ±‚å¯çŸ¥ï¼Œç»„ä»¶æ˜¯ **ç”¨äºéœ€æ±‚æ–¹æ ¹æ®ä¸åŒçš„éœ€æ±‚åŠ¨æ€é€‰æ‹©æ‰€éœ€è¦çš„htmlæ®µè½å¹¶å¯¹å…¶å¯å˜é¡¹è¿›è¡Œç¼–è¾‘**

1. ç»„ä»¶æ˜¯ä¸€ä¸ªhtmlå—ï¼Œå¯ä»¥åŠ¨æ€çš„é€‰æ‹©æ·»åŠ 
2. ç»„ä»¶æ‹¥æœ‰å¯è‡ªå®šä¹‰çš„å˜é‡

æ‰€ä»¥ï¼Œæˆ‘ä»¬é€šè¿‡æ ‡ç­¾æ’å€¼çš„å½¢å¼ä½¿å¾—è¯¥å·¥å…·å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ’å…¥è‡ªå®šä¹‰çš„å˜é‡å€¼ã€‚

å·¦ä¾§ç»„ä»¶ä»£ç å—çš„æ‹–æ‹½æ·»åŠ ï¼ˆæ‹–æ‹½ç»„ä»¶é€‰æ‹©ç¬¬ä¸‰æ–¹åº“ `react-beautiful-dnd`ï¼‰ï¼š

```tsx
import { DragDropContext, Droppable, Draggable, DropResult } from "react-beautiful-dnd"


const CompComponent: React.FC = () => {
  
  // è¿™ä¸ªå‡½æ•°å°±æ˜¯åœ¨æ‹–æ‹½ç»“æŸåæ·»åŠ æ›´æ–°Mainæ•°ç»„ä¸­çš„ç»„ä»¶å—ï¼Œä¸æ˜¯é‡ç‚¹ï¼Œè¿™é‡Œå°±ä¸å ç”¨ç¯‡å¹…å•¦
  // å¦‚æœæƒ³çœ‹è¯¥æ–¹æ³•çš„å…·ä½“å®ç°ï¼Œå¯è®¿é—®ï¼šhttps://github.com/Qionline/Qieditor/blob/master/src/components/main/comp/index.tsx#L14
  const handleDragEnd = () => {}

  return (
    <div className="comp-cmp">
      <div className="comp-title">
        <span>ç»„ä»¶åº“</span>
        <span>é¡µé¢æ¨¡æ¿</span>
      </div>
      <DragDropContext onDragEnd={handleDragEnd}>
        <div>
          {/* ç»„ä»¶åº“ï¼ˆå¯æ‹–æ‹½è‡³é¡µé¢æ¨¡æ¿ï¼‰ */}
          <Droppable isDropDisabled droppableId="compLib">
            {provided => (
              <div ref={provided.innerRef} {...provided.droppableProps}>
                {componentsTree.map((t, i) => (
                  <Draggable draggableId={t.id + ""} index={i} key={t.id}>
                    {(p, s) => (
                      <div ref={p.innerRef} {...p.draggableProps} {...p.dragHandleProps} key={t.id}>
                        {t.name}
                      </div>
                    )}
                  </Draggable>
                ))}
                {provided.placeholder}
              </div>
            )}
          </Droppable>
          
          {/* é¡µé¢æ¨¡æ¿ï¼ˆå¯ä¸Šä¸‹æ‹–æ‹½è°ƒæ•´ç»„ä»¶ä½ç½®ï¼‰ */}
          <Droppable droppableId="compTemp">
            {(provided, snapshot) => {
              return (
                <div ref={provided.innerRef} {...provided.droppableProps}>
                  {mainTree.map((t, i) => (
                    <Draggable draggableId={t.id + ""} index={i} key={t.id}>
                      {(p, s) => {
                        return (
                          <div
                            ref={p.innerRef}
                            {...p.draggableProps}
                            {...p.dragHandleProps}
                          >
                            {t.name}
                          </div>
                        )
                      }}
                    </Draggable>
                  ))}
                  {provided.placeholder}
                </div>
              )
            }}
          </Droppable>
        </div>
      </DragDropContext>
    </div>
  )
}
```


å³ä¾§é…ç½®é¡¹å±•ç¤ºï¼š

```tsx
// å˜é‡è§£æç»„ä»¶ï¼šä»storeä¸­è·å–å˜é‡ï¼Œæ ¹æ®éœ€æ±‚æ–¹çš„ç¼–è¾‘åŠ¨æ€ä¿®æ”¹storeä¸­çš„é…ç½®æ–‡ä»¶
const CompConfItem = ({ idx, paramKey, paramValue }) => {
  const { handleSetParamValue } = useDataStore()
  const handleChangedParams = (res: string | ParamArrayParamTypeProp[]) => {
    handleSetParamValue(idx, res, paramKey)
  }
  return (
    <div>
      <Input value={paramValue.value} onChange={e => handleChangedParams(e.target.value)} />
    </div>
  )
}

// å…¨å±€é…ç½®
const ConfGlobal: React.FC = () => (
  <div>
    <span>å¯¼å‡ºæ–‡ä»¶å</span>
    <div>
    	<Input value={globalSetting.filename} onChange={handleChangeFilename} />
    </div>

    <span>é¡µé¢æ ‡é¢˜</span>
    <div>
      <Input value={globalSetting.global.title} onChange={handleChangeTitle} />
    </div>
    
    /* è¿™é‡Œçš„ globalSetting.global.params æ˜¯ä»storeä¸­å–å‡ºçš„å…¨å±€å˜é‡ */
    {Object.keys(globalSetting.global.params).map((v, i) => {
      const el = globalSetting.global.params[v]
      return (
      <div key={i}>
        <span>{el.title}</span>
        <CompConfItem idx={-1} paramKey={v} paramValue={{ ...el }} />
      </div>
      )
    })}
  </div>
)

// ç»„ä»¶é…ç½®
const ConfComponent: React.FC = () => (
  <div>
    <span className="title">
      {mainTree[componetSelectState].name}({componetSelectState})
    </span>
    <div>
      /* è¿™é‡Œçš„ mainTre æ˜¯ä»storeä¸­å–å‡ºçš„ç»„ä»¶æ ‘ï¼Œå…¶ä¸­componetSelectState ä¸ºå½“å‰é€‰ä¸­çš„ç»„ä»¶ */
      {Object.keys(mainTree[componetSelectState].params).length === 0 ? (
        <div>è¯¥ç»„ä»¶æ— é…ç½®é¡¹</div>
        ) : (
        Object.keys(mainTree[componetSelectState].params).map((v, i) => {
          const el = mainTree[componetSelectState].params[v]
          return (
            <div key={i}>
              <span>{el.title}</span>
              <CompConfItem idx={componetSelectState} paramKey={v} paramValue={{ ...el }} />
            </div>
          )
        })
      )}
    </div>
  </div>
)
```


è¯¥æ®µä»£ç å‡ä¸ºå±•ç¤ºæ€§ä»£ç ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡å¯è§†åŒ–çš„å½¢å¼å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹

## é…ç½®æ–‡ä»¶è§£æä¸æ¸²æŸ“

è¯¥å·¥å…·çš„æ•´ä¸ªæµç¨‹çš†å§‹äºé…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶åœ¨å·¥å…·ä¸­å¯è§†åŒ–çš„æ˜¾å¼ç»™éœ€æ±‚æ–¹è¿›è¡Œé…ç½®ï¼Œé…ç½®å®Œæˆåè®²æ›´æ–°çš„é…ç½®æ–‡ä»¶è¿›è¡Œè§£æç¼–è¯‘

ä¸Šæ–‡å·²å®Œæˆçš„é…ç½®æ–‡ä»¶çš„é¡µé¢å±•ç¤ºï¼Œæ¥ä¸‹æ¥å’±ä»¬å°±æ¥å®Œæˆè§£æç¼–è¯‘çš„éƒ¨åˆ†ã€‚

### ã€è§£æã€‘ç»„ä»¶ä»£ç å—ç¼–è¯‘

ç±»å‹å®šä¹‰ï¼š
```typescript
// å˜é‡ç±»å‹
export interface ParamTextType {
  type: "text"
  title: string
  value: string
}
export interface ParamArrayType {
  type: "array"
  title: string
  template: string
  item: ParamArrayParamTypeProp
  value: ParamArrayParamTypeProp[]
}
export type ParamArrayTypeProp = ParamTextType 
export type ParamTypeProp = ParamTextType | ParamArrayType

export interface ParamArrayParamTypeProp {
  [propName: string]: ParamArrayTypeProp
}
export interface componentsTreePramasProp {
  [propName: string]: ParamTypeProp
}
// å…¨å±€é…ç½®ç±»å‹å®šä¹‰
export interface globalSettingProp {
  filename: string
  global: {
    title: string
    direction: "ltr" | "rtl"
    bodyColor: string
    css: string
    js: string
    beforeLoadJs?: string
    externalCss?: string[]
    externalJs?: string[]
    params: componentsTreePramasProp
  }
}
// ç»„ä»¶é¡¹ç±»å‹å®šä¹‰
export interface componentsTreeProp {
  id: number
  name: string
  params: componentsTreePramasProp
  htmlstr: string
}
```

ç¼–è¯‘å®ç°ï¼š
```typescript
// å†…éƒ¨å…³é”®å­—ã€ä½¿ç”¨è€…ç¦æ­¢ä½¿ç”¨å…³é”®å­—ä¸­å‡ºç°çš„å€¼ä½œä¸ºå˜é‡ï¼Œæ­¤å…³é”®å­—ç”¨äºè·å–ç»„ä»¶å—çš„domä»¥æ–¹ä¾¿jsæ“ä½œ
const KEY_WORD = {
  QID: "<%Qid%>",
  QIDDOM: "<%QidDom%>",
}

// é”™è¯¯å¤„ç†
const handleArrayTypeError = function () {
  throw new Error("é…ç½®æ–‡ä»¶é”™è¯¯ï¼šç¦æ­¢arrayç±»å‹å‚æ•°ä¸­ä½¿ç”¨arrayç±»å‹å‚æ•°ä½œä¸ºå­å˜é‡!")
}

// æ•°ç»„å˜é‡ç±»å‹è§£æ
const handleArrayTmp = function (template: string, vArray: ParamArrayParamTypeProp[],  comonParams: componentsTreePramasProp) {
  let tmp: string[] = []
  const reg = /<%\w*%>+/g
  const paramsArr = template.match(reg)
  if (!paramsArr) {
    vArray.forEach(() => {
      tmp.push(template)
    })
    return tmp.join("")
  }

  vArray.forEach(el => {
    let vTemp = template
    for (const value of paramsArr) {
      const param = value.split("%")[1]
      if (el[param]) vTemp = vTemp.replace(new RegExp(value), el[param].value)
      else if (comonParams[param]) {
        if (comonParams[param].type === "array") handleArrayTypeError()
        vTemp = vTemp.replace(new RegExp(value), comonParams[param].value as string)
      }
    }
    tmp.push(vTemp)
  })

  return tmp.join("")
}

// ç¼–è¯‘ï¼šå­—ç¬¦ä¸²æ›¿æ¢ï¼ˆæ›¿æ¢<% %>ä¸­çš„å†…å®¹ï¼‰
const TmpReplace = function (id: number, tmp: string, compParams: componentsTreePramasProp, globalParams: componentsTreePramasProp): string {
  // åœ¨æ ¹divä¸­æ³¨å…¥qid <div qid=`q${id}`></div>
  // qid å¯ç”¨äºjsä¸­è·å–ç»„ä»¶å—çš„domï¼Œå½“ç„¶è¿™å¯æ ¹æ®éœ€æ±‚é€‰æ‹©æ˜¯å¦éœ€è¦
  const qidReg = /<div/
  tmp = tmp.replace(qidReg, `<div qid="q${id}"`)

  // å…³é”®å­—æ›¿æ¢
  tmp = tmp.replace(new RegExp(KEY_WORD.QID), `q${id}`)
  tmp = tmp.replace(new RegExp(KEY_WORD.QIDDOM), `document.querySelectorAll('[qid="q${id}"]')[0]`)

  // åŒ¹é…è‡ªå®šä¹‰å˜é‡æ›¿æ¢
  const reg = /<%\w*%>+/g
  const paramsArr = tmp.match(reg)
  if (!paramsArr) return tmp
  
  // æŒ‰ç…§å±‚çº§æ›¿æ¢å˜é‡å€¼
  for (const value of paramsArr) {
    const param = value.split("%")[1]
    if (compParams[param]) {
      tmp = tmp.replace(
        new RegExp(value),
        compParams[param].type === "array"
          ? handleArrayTmp((compParams[param] as ParamArrayType).template, (compParams[param] as ParamArrayType).value, compParams)
          : (compParams[param].value as string)
      )
    } else if (globalParams[param]) {
      tmp = tmp.replace(
        new RegExp(value),
        globalParams[param].type === "array"
          ? handleArrayTmp((globalParams[param] as ParamArrayType).template, (globalParams[param] as ParamArrayType).value, globalParams)
          : (globalParams[param].value as string)
      )
    }
  }

  return tmp
}
```

### ã€æ¸²æŸ“ã€‘æ–‡ä»¶é¢„è§ˆä¸ç”Ÿæˆ

é¢„è§ˆå’Œç”Ÿæˆçš„é€»è¾‘ç›¸ä¼¼ï¼Œå‰è€…æ˜¯å°†é…ç½®æ–‡ä»¶è½¬åŒ–ä¸ºhtmlå­—ç¬¦ä¸²æ’å…¥iframeè¿›è¡Œé¢„è§ˆï¼Œåè€…åˆ™æ˜¯è®²ç”Ÿæˆçš„htmlå­—ç¬¦ä¸²è½¬åŒ–ä¸ºæ–‡ä»¶å¹¶ä¸‹è½½ã€‚ä¸‹é¢é€šè¿‡ä»£ç å±•ç¤ºé…ç½®æ–‡ä»¶è½¬åŒ–ä¸ºhtmléƒ¨åˆ†ï¼š

```typescript
interface SData2HtmlFuncProp {
  (globalSetting: globalSettingProp, mainTree: componentsTreeProp[])
}

 const SData2Html: SData2HtmlFuncProp = (globalSetting, mainTree) => {
  let main = ""
  // ä¾æ¬¡æŒ‰ç…§Mainä¸­çš„ç»„ä»¶è¿›è¡Œè§£æä¸ºhtmlå­—ç¬¦ä¸²
  mainTree.forEach(el => {
    // TmpReplaceè§ ä¸Šæ–‡ç»„ä»¶ä»£ç å—ç¼–è¯‘ éƒ¨åˆ†
    const res = TmpReplace(el.id, el.htmlstr, el.params, globalSetting.global.params)
    main += res
  })

  const beforeLoadJs = globalSetting.global?.beforeLoadJs ? `<script>${globalSetting.global.beforeLoadJs}</script>` : ""
  const externalCss = globalSetting.global?.externalCss ? [...globalSetting.global.externalCss] : []
  const externalJs = globalSetting.global?.externalJs ? [...globalSetting.global.externalJs] : []

  return `
  <!DOCTYPE html>
  <html>
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
      <meta http-equiv="X-UA-Compatible" content="ie=edge" />
      <title>${globalSetting.global.title}</title>
      ${externalCss.map(v => `<link rel="stylesheet" href="${v}" />`).join("")}
      ${beforeLoadJs}
    </head>
    <style>body{background-color:${globalSetting.global.bodyColor};direction:${globalSetting.global.direction}}</style>
    ${globalSetting.global.css ? `<style>${globalSetting.global.css}</style>` : ``}
    <body>
      <div id="qiapp">${main}</div>
    </body>
    ${externalJs.map(v => `<script src="${v}"></script>`).join("")}
    ${globalSetting.global.js ? `<script>${globalSetting.global.js}</script>` : ``}
    </html>
  `
}
```

å­—ç¬¦ä¸²ç”Ÿæˆåï¼Œåªéœ€è¦åŠ¨æ€æ·»åŠ æ›´æ–°ifameå³å¯å®Œæˆé¢„è§ˆå•¦ã€‚

ä»¥ä¸Šï¼Œæ•´ä¸ªç¼–è¾‘å™¨å®ç°çš„æ ¸å¿ƒæ€è·¯å°±éƒ½å·²å®Œæˆ ğŸ‰

## å®Œæ•´ä»£ç 

å®Œæ•´ä»£ç æˆ‘å·²å®ç°å¹¶ä¸Šä¼ è‡³è¯¥ [ä»“åº“](https://github.com/Qionline/Qieditor)ï¼Œ

å¦‚æœå¤§å®¶ä¹Ÿæœ‰ç±»ä¼¼çš„éœ€æ±‚éœ€è¦åº”ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œ æˆ–è€…å…·ä½“å®ç°ä¸Šéœ€è¦æœ‰æ‰€å‚è€ƒçš†å¯è®¿é—®æ­¤ä»“åº“å…±åŒäº¤æµå­¦ä¹ ï½

åŒæ—¶ï¼Œç”±äºæœ¬èº«jsonæ–‡ä»¶çš„ç¼–å†™è¾ƒä¸ºç¹çã€è°ƒè¯•æ€§è¾ƒå·®ã€‚æˆ‘å†™äº†ä¸€ä¸ªç®€æ˜“çš„å¼€å‘å·¥å…·ï¼Œæ–¹ä¾¿å¤§å®¶ä»¥è¿‘ä¼¼çº¯åŸç”Ÿçš„å¼€å‘æ¨¡å¼æ¥å¼€å‘&è°ƒè¯•æ¨¡æ¿æ–‡ä»¶ï¼Œå¦‚æœ‰éœ€è¦å¯[ ç‚¹å‡»æ­¤å¤„ ](https://github.com/Qionline/Qieditor-template)æŸ¥çœ‹ã€‚